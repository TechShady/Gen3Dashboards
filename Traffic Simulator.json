{"version":13,"variables":[{"key":"AppName","type":"code","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n const lastXDays = 1;\n const usqlQuery = 'SELECT DISTINCT application FROM useraction';\n const response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: Date.now() - lastXDays * 24 * 60 * 60 * 1000});\n const sampleCount = response.values.length;\n function flatten(arr) {\n    var flat = [];\n    for (var i = 0; i < sampleCount; i++) {\n        flat = flat.concat(arr[i]);\n    }\n    return flat;\n}\n return( flatten(response.values))\n}","multiple":true},{"key":"TrafficChangePercent","type":"csv","input":"5,10,20,25,50,100,150,200,250,300,350,400,450,500","multiple":false},{"key":"ActionCategory","type":"csv","input":"All,Key,Entry,Exit","multiple":false},{"key":"LocationFilter","type":"csv","input":"Country,Continent,Region,City","multiple":false},{"key":"EnvironmentFilter","type":"csv","input":"browserFamily,browserMajorVersion,ISP,osFamily,osVersion","multiple":false},{"key":"KPI","type":"csv","input":"Duration,VisuallyCompleteTime,SpeedIndex,LoadEventEnd,FirstInputDelay,CumulativeLayoutShift,LargestContentfulPaint,CdnBusyTime,CdnResources,DocumentInteractiveTime,DomCompleteTime,DomContentLoadedTime,FirstPartyBusyTime,FirstPartyResources,FrontendTime,LoadEventStart,NavigationStart,NetworkTime,RequestStart,ResponseEnd,ResponseStart,ServerTime,ThirdPartyBusyTime,ThirdPartyResources","multiple":false},{"key":"ActionType","type":"csv","input":"Load, Xhr","multiple":true}],"tiles":{"2":{"type":"code","title":"$KPI Impact (ms)","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = $KPI;\n  const metricName = \"Avg \"+$KPI;\n  const metricAgg = \"avg\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n  if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n  if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n  if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n  const response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n  if (response.values.length<6) return \"Try increasing the timeframe.\";\n  const sampleCount = response.values.length-6;\n  let percentChangeMetric = 0;\n  let percentChangeTraffic = 0;\n  let trafficAVG = 0;\n  let metricAVG = 0;\n  let metricMIN = response.values[0][2];\n  let metricAAVG = 0;\n  let metricBAVG = 0;\n  let trafficAAVG = 0;\n  let trafficBAVG = 0;\n  let c = 0;\n  while (c < sampleCount) {\n    trafficAVG = trafficAVG + response.values[c][1];\n    metricAVG = metricAVG + response.values[c][2];\n    if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n    c++;\n  }\n  let i2 = 0;\n  let i2A = 0;\n  let i2B = 0;\n    while (i2 < sampleCount) {\n          if (response.values[i2][1]>(trafficAVG/sampleCount))\n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricAAVG=metricAAVG+response.values[i2][2];\n              trafficAAVG=trafficAAVG+response.values[i2][1];\n              i2A++;\n                  }\n            }\n          if (response.values[i2][1]<(trafficAVG/sampleCount)) \n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricBAVG=metricBAVG+response.values[i2][2];\n              trafficBAVG=trafficBAVG+response.values[i2][1];\n              i2B++;\n                  }\n            }\n          i2++;\n        }\n  percentChangeMetric = (Number(metricAAVG/i2A) - Number(metricBAVG/i2B))/Number(metricBAVG/i2B)*100;\n  percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n  var predictedMetric=(metricAVG/sampleCount) + (metricAVG/sampleCount*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n  console.log(\"Traffic Below:\",trafficBAVG/i2B)\n  console.log(\"Traffic Average:\",trafficAVG/sampleCount)\n  console.log(\"Traffic Above:\",trafficAAVG/i2A)\n  console.log(\"Traffic Change:\",percentChangeTraffic)\n  console.log(\"Metric Min:\",metricMIN)\n  console.log(\"Metric Below:\",metricBAVG/i2B)\n  console.log(\"Metric Average:\",metricAVG/sampleCount)\n  console.log(\"Metric Above:\",metricAAVG/i2A)\n  console.log(\"Metric Change:\",percentChangeMetric)\n  console.log(\"Predicted Metric:\",predictedMetric)\n  if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n  return metricName+\" is \"+Number(metricAVG/sampleCount).toFixed(2)+\". Predicted \"+metricName+\" is \"+(predictedMetric).toFixed(2)+\" modeled with a \"+$TrafficChangePercent+\"% traffic increase.\";\n}","visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"start","recordField":"element"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"Diff","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1701281148734}]}},"5":{"type":"code","title":"$KPI Change","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = $KPI;\n  const metricName = \"Avg Duration\";\n  const metricAgg = \"avg\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n  if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n  if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n  if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n  const response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n  if (response.values.length<6) return \"Try increasing the timeframe.\";\n  const sampleCount = response.values.length-6;\n  let percentChangeMetric = 0;\n  let percentChangeTraffic = 0;\n  let trafficAVG = 0;\n  let metricAVG = 0;\n  let metricMIN = response.values[0][2];\n  let metricAAVG = 0;\n  let metricBAVG = 0;\n  let trafficAAVG = 0;\n  let trafficBAVG = 0;\n  let c = 0;\n  while (c < sampleCount) {\n    trafficAVG = trafficAVG + response.values[c][1];\n    metricAVG = metricAVG + response.values[c][2];\n    if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n    c++;\n  }\n  let i2 = 0;\n  let i2A = 0;\n  let i2B = 0;\n    while (i2 < sampleCount) {\n          if (response.values[i2][1]>(trafficAVG/sampleCount))\n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricAAVG=metricAAVG+response.values[i2][2];\n              trafficAAVG=trafficAAVG+response.values[i2][1];\n              i2A++;\n                  }\n            }\n          if (response.values[i2][1]<(trafficAVG/sampleCount)) \n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricBAVG=metricBAVG+response.values[i2][2];\n              trafficBAVG=trafficBAVG+response.values[i2][1];\n              i2B++;\n                  }\n            }\n          i2++;\n        }\n  percentChangeMetric = (Number(metricAAVG/i2A) - Number(metricBAVG/i2B))/Number(metricBAVG/i2B)*100;\n  percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n  var predictedMetric=(metricAVG/sampleCount) + (metricAVG/sampleCount*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n  console.log(\"Traffic Below:\",trafficBAVG/i2B)\n  console.log(\"Traffic Average:\",trafficAVG/sampleCount)\n  console.log(\"Traffic Above:\",trafficAAVG/i2A)\n  console.log(\"Traffic Change:\",percentChangeTraffic)\n  console.log(\"Metric Min:\",metricMIN)\n  console.log(\"Metric Below:\",metricBAVG/i2B)\n  console.log(\"Metric Average:\",metricAVG/sampleCount)\n  console.log(\"Metric Above:\",metricAAVG/i2A)\n  console.log(\"Metric Change:\",percentChangeMetric)\n  console.log(\"Predicted Metric:\",predictedMetric)\n  if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n  return ($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric+0;\n}","visualization":"singleValue","visualizationSettings":{"thresholds":[{"id":1,"field":"element","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≤","label":"","value":-3},{"id":1,"color":"#FCD53F","comparator":">","label":"","value":-3},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":3}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","trend":{"isVisible":false},"sparklineSettings":{"isVisible":false},"colorThresholdTarget":"value","recordField":"element"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"element","unitCategory":"percentage","baseUnit":"percent","displayUnit":"percent","decimals":2,"suffix":"%","delimiter":false,"added":1701281148734}]}},"7":{"type":"code","title":"$KPI Distribution Below/Above Traffic Average","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = $KPI;\n  const metricName = \"Avg Duration\";\n  const metricAgg = \"avg\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n  if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n  if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n  if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n  const response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n  if (response.values.length<6) return \"Try increasing the timeframe.\";\n  const sampleCount = response.values.length-6;\n  let percentChangeMetric = 0;\n  let percentChangeTraffic = 0;\n  let trafficAVG = 0;\n  let metricAVG = 0;\n  let metricMIN = response.values[0][2];\n  let metricAAVG = 0;\n  let metricBAVG = 0;\n  let trafficAAVG = 0;\n  let trafficBAVG = 0;\n  let c = 0;\n  while (c < sampleCount) {\n    trafficAVG = trafficAVG + response.values[c][1];\n    metricAVG = metricAVG + response.values[c][2];\n    if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n    c++;\n  }\n  let i2 = 0;\n  let i2A = 0;\n  let i2B = 0;\n    while (i2 < sampleCount) {\n          if (response.values[i2][1]>(trafficAVG/sampleCount))\n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricAAVG=metricAAVG+response.values[i2][2];\n              trafficAAVG=trafficAAVG+response.values[i2][1];\n              i2A++;\n                  }\n            }\n          if (response.values[i2][1]<(trafficAVG/sampleCount)) \n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricBAVG=metricBAVG+response.values[i2][2];\n              trafficBAVG=trafficBAVG+response.values[i2][1];\n              i2B++;\n                  }\n            }\n          i2++;\n        }\nreturn {\n    records: [\n     {\n        'Traffic': \"Below Average\",\n        'Duration': (metricBAVG/i2B)\n      },\n    {   'Traffic': \"Average\",\n        'Duration': (metricAVG/sampleCount)\n      },\n    {   'Traffic': \"Above Average\",\n        'Duration': (metricAAVG/i2A)\n      },\n],\n    types: [\n      {\n        indexRange: [0, 2],\n        mappings: {\n          'Traffic': { type: 'string' },\n          'Duration': { type: 'double' }\n        },\n      },\n    ],\n  };\n}","visualization":"categoricalBarChart","visualizationSettings":{"thresholds":[{"id":1,"field":"","title":"","isEnabled":true,"rules":[{"id":0,"color":{"Default":"var(--dt-colors-charts-categorical-color-09-default, #649438)"},"comparator":"≥","label":""},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"},"comparator":"≥","label":""},{"id":2,"color":{"Default":"var(--dt-colors-charts-categorical-color-12-default, #cd3741)"},"comparator":"≥","label":""}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{"Below Average":{"color":"#00D26A","added":1701452595143},"Average":{"color":"#FCD53F","added":1701452607415},"Above Average":{"color":"#F8312F","added":1701452636972}},"legend":{"hidden":true},"categoricalBarChartSettings":{"categoryAxis":"Traffic","categoryAxisLabel":"Traffic","valueAxis":"Duration","valueAxisLabel":"Duration"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","recordField":"Traffic"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"Diff","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1701281148734}]}},"10":{"type":"code","title":"$KPI Health","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = $KPI;\n  const metricName = \"Avg Duration\";\n  const metricAgg = \"avg\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n  if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n  if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n  if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n  const response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n  if (response.values.length<6) return \"Try increasing the timeframe.\";\n  const sampleCount = response.values.length-6;\n  let percentChangeMetric = 0;\n  let percentChangeTraffic = 0;\n  let trafficAVG = 0;\n  let metricAVG = 0;\n  let metricMIN = response.values[0][2];\n  let metricAAVG = 0;\n  let metricBAVG = 0;\n  let trafficAAVG = 0;\n  let trafficBAVG = 0;\n  let c = 0;\n  while (c < sampleCount) {\n    trafficAVG = trafficAVG + response.values[c][1];\n    metricAVG = metricAVG + response.values[c][2];\n    if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n    c++;\n  }\n  let i2 = 0;\n  let i2A = 0;\n  let i2B = 0;\n    while (i2 < sampleCount) {\n          if (response.values[i2][1]>(trafficAVG/sampleCount))\n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricAAVG=metricAAVG+response.values[i2][2];\n              trafficAAVG=trafficAAVG+response.values[i2][1];\n              i2A++;\n                  }\n            }\n          if (response.values[i2][1]<(trafficAVG/sampleCount)) \n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricBAVG=metricBAVG+response.values[i2][2];\n              trafficBAVG=trafficBAVG+response.values[i2][1];\n              i2B++;\n                  }\n            }\n          i2++;\n        }\n  percentChangeMetric = (Number(metricAAVG/i2A) - Number(metricBAVG/i2B))/Number(metricBAVG/i2B)*100;\n  percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n  var predictedMetric=(metricAVG/sampleCount) + (metricAVG/sampleCount*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n  console.log(\"Traffic Below:\",trafficBAVG/i2B)\n  console.log(\"Traffic Average:\",trafficAVG/sampleCount)\n  console.log(\"Traffic Above:\",trafficAAVG/i2A)\n  console.log(\"Traffic Change:\",percentChangeTraffic)\n  console.log(\"Metric Min:\",metricMIN)\n  console.log(\"Metric Below:\",metricBAVG/i2B)\n  console.log(\"Metric Average:\",metricAVG/sampleCount)\n  console.log(\"Metric Above:\",metricAAVG/i2A)\n  console.log(\"Metric Change:\",percentChangeMetric)\n  console.log(\"Predicted Metric:\",predictedMetric)\n  if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n  if (($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric>3) return \"🔴\";\n  if (($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric<-3) return \"🟢\";\n  return \"🟡\"\n}","visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","recordField":"element"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"Diff","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1701281148734}]}},"11":{"type":"markdown","title":"","content":"![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABy8AAAAMCAYAAADbJPG3AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAACdSURBVHhe7dtBFcAgDETBUBtFA6KrDhf0gofsYeay8fBfRn37FAAAAAAAAECz5y4AAAAAAABAK/ESAAAAAAAAiCBeAgAAAAAAABHESwAAAAAAACCCeAkAAAAAAABEEC8BAAAAAACACOIlAAAAAAAAEGG8c517AwAAAAAAALTxeQkAAAAAAABEEC8BAAAAAACACOIlAAAAAAAAEKDqB2IIBAQ2TEouAAAAAElFTkSuQmCC)"},"12":{"type":"markdown","title":"","content":"![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABy8AAAAMCAYAAADbJPG3AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAACdSURBVHhe7dtBFcAgDETBUBtFA6KrDhf0gofsYeay8fBfRn37FAAAAAAAAECz5y4AAAAAAABAK/ESAAAAAAAAiCBeAgAAAAAAABHESwAAAAAAACCCeAkAAAAAAABEEC8BAAAAAACACOIlAAAAAAAAEGG8c517AwAAAAAAALTxeQkAAAAAAABEEC8BAAAAAACACOIlAAAAAAAAEKDqB2IIBAQ2TEouAAAAAElFTkSuQmCC)"},"13":{"type":"markdown","title":"","content":"![](data:image/webp;base64,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)"},"14":{"type":"markdown","title":"","content":"![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABy8AAAAMCAYAAADbJPG3AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAACdSURBVHhe7dtBFcAgDETBUBtFA6KrDhf0gofsYeay8fBfRn37FAAAAAAAAECz5y4AAAAAAABAK/ESAAAAAAAAiCBeAgAAAAAAABHESwAAAAAAACCCeAkAAAAAAABEEC8BAAAAAACACOIlAAAAAAAAEGG8c517AwAAAAAAALTxeQkAAAAAAABEEC8BAAAAAACACOIlAAAAAAAAEKDqB2IIBAQ2TEouAAAAAElFTkSuQmCC)"},"15":{"type":"markdown","title":"","content":"![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABy8AAAAMCAYAAADbJPG3AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAACdSURBVHhe7dtBFcAgDETBUBtFA6KrDhf0gofsYeay8fBfRn37FAAAAAAAAECz5y4AAAAAAABAK/ESAAAAAAAAiCBeAgAAAAAAABHESwAAAAAAACCCeAkAAAAAAABEEC8BAAAAAACACOIlAAAAAAAAEGG8c517AwAAAAAAALTxeQkAAAAAAABEEC8BAAAAAACACOIlAAAAAAAAEKDqB2IIBAQ2TEouAAAAAElFTkSuQmCC)"},"17":{"type":"code","title":"Request Error Health","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = \"requestErrorCount\";\n  const metricName = \"Error Count\";\n  const metricAgg = \"sum\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n  if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n  if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n  if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n  const response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n  if (response.values.length<6) return \"Try increasing the timeframe.\";\n  const sampleCount = response.values.length-6;\n  let percentChangeMetric = 0;\n  let percentChangeTraffic = 0;\n  let trafficAVG = 0;\n  let metricAVG = 0;\n  let metricMIN = response.values[0][2];\n  let metricAAVG = 0;\n  let metricBAVG = 0;\n  let trafficAAVG = 0;\n  let trafficBAVG = 0;\n  let c = 0;\n  while (c < sampleCount) {\n    trafficAVG = trafficAVG + response.values[c][1];\n    metricAVG = metricAVG + response.values[c][2];\n    if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n    c++;\n  }\n  let i2 = 0;\n  let i2A = 0;\n  let i2B = 0;\n    while (i2 < sampleCount) {\n          if (response.values[i2][1]>(trafficAVG/sampleCount))\n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricAAVG=metricAAVG+response.values[i2][2];\n              trafficAAVG=trafficAAVG+response.values[i2][1];\n              i2A++;\n                  }\n            }\n          if (response.values[i2][1]<(trafficAVG/sampleCount)) \n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricBAVG=metricBAVG+response.values[i2][2];\n              trafficBAVG=trafficBAVG+response.values[i2][1];\n              i2B++;\n                  }\n            }\n          i2++;\n        }\n  percentChangeMetric = (Number(metricAAVG/i2A) - Number(metricBAVG/i2B))/Number(metricBAVG/i2B)*100;\n  percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n  var predictedMetric=(metricAVG/sampleCount) + (metricAVG/sampleCount*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n  console.log(\"Traffic Below:\",trafficBAVG/i2B)\n  console.log(\"Traffic Average:\",trafficAVG/sampleCount)\n  console.log(\"Traffic Above:\",trafficAAVG/i2A)\n  console.log(\"Traffic Change:\",percentChangeTraffic)\n  console.log(\"Metric Min:\",metricMIN)\n  console.log(\"Metric Below:\",metricBAVG/i2B)\n  console.log(\"Metric Average:\",metricAVG/sampleCount)\n  console.log(\"Metric Above:\",metricAAVG/i2A)\n  console.log(\"Metric Change:\",percentChangeMetric)\n  console.log(\"Predicted Metric:\",predictedMetric)\n  if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n  if (($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric>3) return \"🔴\";\n  if (($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric<-3) return \"🟢\";\n  return \"🟡\"\n}","visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","recordField":"element"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"Diff","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1701281148734}]}},"18":{"type":"code","title":"Request Error Impact","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = \"requestErrorCount\";\n  const metricName = \"Error Average\";\n  const metricAgg = \"sum\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n  if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n  if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n  if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n  const response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n  if (response.values.length<6) return \"Try increasing the timeframe.\";\n  const sampleCount = response.values.length-6;\n  let percentChangeMetric = 0;\n  let percentChangeTraffic = 0;\n  let trafficAVG = 0;\n  let metricAVG = 0;\n  let metricMIN = response.values[0][2];\n  let metricAAVG = 0;\n  let metricBAVG = 0;\n  let trafficAAVG = 0;\n  let trafficBAVG = 0;\n  let c = 0;\n  while (c < sampleCount) {\n    trafficAVG = trafficAVG + response.values[c][1];\n    metricAVG = metricAVG + response.values[c][2];\n    if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n    c++;\n  }\n  let i2 = 0;\n  let i2A = 0;\n  let i2B = 0;\n    while (i2 < sampleCount) {\n          if (response.values[i2][1]>(trafficAVG/sampleCount))\n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricAAVG=metricAAVG+response.values[i2][2];\n              trafficAAVG=trafficAAVG+response.values[i2][1];\n              i2A++;\n                  }\n            }\n          if (response.values[i2][1]<(trafficAVG/sampleCount)) \n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricBAVG=metricBAVG+response.values[i2][2];\n              trafficBAVG=trafficBAVG+response.values[i2][1];\n              i2B++;\n                  }\n            }\n          i2++;\n        }\n  percentChangeMetric = (Number(metricAAVG/i2A) - Number(metricBAVG/i2B))/Number(metricBAVG/i2B)*100;\n  percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n  var predictedMetric=(metricAVG/sampleCount) + (metricAVG/sampleCount*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n  console.log(\"Traffic Below:\",trafficBAVG/i2B)\n  console.log(\"Traffic Average:\",trafficAVG/sampleCount)\n  console.log(\"Traffic Above:\",trafficAAVG/i2A)\n  console.log(\"Traffic Change:\",percentChangeTraffic)\n  console.log(\"Metric Min:\",metricMIN)\n  console.log(\"Metric Below:\",metricBAVG/i2B)\n  console.log(\"Metric Average:\",metricAVG/sampleCount)\n  console.log(\"Metric Above:\",metricAAVG/i2A)\n  console.log(\"Metric Change:\",percentChangeMetric)\n  console.log(\"Predicted Metric:\",predictedMetric)\n  if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n  return metricName+\" is \"+Number(metricAVG/sampleCount).toFixed(2)+\". Predicted \"+metricName+\" is \"+(predictedMetric).toFixed(2)+\" modeled with a \"+$TrafficChangePercent+\"% traffic increase.\";\n}","visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"start","recordField":"element"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"Diff","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1701281148734}]}},"20":{"type":"code","title":"JavaScript Error Impact","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = \"javascriptErrorCount\";\n  const metricName = \"Error Average\";\n  const metricAgg = \"sum\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n  if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n  if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n  if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n  const response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n  if (response.values.length<6) return \"Try increasing the timeframe.\";\n  const sampleCount = response.values.length-6;\n  let percentChangeMetric = 0;\n  let percentChangeTraffic = 0;\n  let trafficAVG = 0;\n  let metricAVG = 0;\n  let metricMIN = response.values[0][2];\n  let metricAAVG = 0;\n  let metricBAVG = 0;\n  let trafficAAVG = 0;\n  let trafficBAVG = 0;\n  let c = 0;\n  while (c < sampleCount) {\n    trafficAVG = trafficAVG + response.values[c][1];\n    metricAVG = metricAVG + response.values[c][2];\n    if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n    c++;\n  }\n  let i2 = 0;\n  let i2A = 0;\n  let i2B = 0;\n    while (i2 < sampleCount) {\n          if (response.values[i2][1]>(trafficAVG/sampleCount))\n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricAAVG=metricAAVG+response.values[i2][2];\n              trafficAAVG=trafficAAVG+response.values[i2][1];\n              i2A++;\n                  }\n            }\n          if (response.values[i2][1]<(trafficAVG/sampleCount)) \n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricBAVG=metricBAVG+response.values[i2][2];\n              trafficBAVG=trafficBAVG+response.values[i2][1];\n              i2B++;\n                  }\n            }\n          i2++;\n        }\n  percentChangeMetric = (Number(metricAAVG/i2A) - Number(metricBAVG/i2B))/Number(metricBAVG/i2B)*100;\n  percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n  var predictedMetric=(metricAVG/sampleCount) + (metricAVG/sampleCount*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n  console.log(\"Traffic Below:\",trafficBAVG/i2B)\n  console.log(\"Traffic Average:\",trafficAVG/sampleCount)\n  console.log(\"Traffic Above:\",trafficAAVG/i2A)\n  console.log(\"Traffic Change:\",percentChangeTraffic)\n  console.log(\"Metric Min:\",metricMIN)\n  console.log(\"Metric Below:\",metricBAVG/i2B)\n  console.log(\"Metric Average:\",metricAVG/sampleCount)\n  console.log(\"Metric Above:\",metricAAVG/i2A)\n  console.log(\"Metric Change:\",percentChangeMetric)\n  console.log(\"Predicted Metric:\",predictedMetric)\n  if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n  return metricName+\" is \"+Number(metricAVG/sampleCount).toFixed(2)+\". Predicted \"+metricName+\" is \"+(predictedMetric).toFixed(2)+\" modeled with a \"+$TrafficChangePercent+\"% traffic increase.\";\n}","visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"start","recordField":"element"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"Diff","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1701281148734}]}},"21":{"type":"code","title":"JavaScript Error Health","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = \"javascriptErrorCount\";\n  const metricName = \"Error Count\";\n  const metricAgg = \"sum\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n  if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n  if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n  if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n  const response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n  if (response.values.length<6) return \"Try increasing the timeframe.\";\n  const sampleCount = response.values.length-6;\n  let percentChangeMetric = 0;\n  let percentChangeTraffic = 0;\n  let trafficAVG = 0;\n  let metricAVG = 0;\n  let metricMIN = response.values[0][2];\n  let metricAAVG = 0;\n  let metricBAVG = 0;\n  let trafficAAVG = 0;\n  let trafficBAVG = 0;\n  let c = 0;\n  while (c < sampleCount) {\n    trafficAVG = trafficAVG + response.values[c][1];\n    metricAVG = metricAVG + response.values[c][2];\n    if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n    c++;\n  }\n  let i2 = 0;\n  let i2A = 0;\n  let i2B = 0;\n    while (i2 < sampleCount) {\n          if (response.values[i2][1]>(trafficAVG/sampleCount))\n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricAAVG=metricAAVG+response.values[i2][2];\n              trafficAAVG=trafficAAVG+response.values[i2][1];\n              i2A++;\n                  }\n            }\n          if (response.values[i2][1]<(trafficAVG/sampleCount)) \n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricBAVG=metricBAVG+response.values[i2][2];\n              trafficBAVG=trafficBAVG+response.values[i2][1];\n              i2B++;\n                  }\n            }\n          i2++;\n        }\n  percentChangeMetric = (Number(metricAAVG/i2A) - Number(metricBAVG/i2B))/Number(metricBAVG/i2B)*100;\n  percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n  var predictedMetric=(metricAVG/sampleCount) + (metricAVG/sampleCount*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n  console.log(\"Traffic Below:\",trafficBAVG/i2B)\n  console.log(\"Traffic Average:\",trafficAVG/sampleCount)\n  console.log(\"Traffic Above:\",trafficAAVG/i2A)\n  console.log(\"Traffic Change:\",percentChangeTraffic)\n  console.log(\"Metric Min:\",metricMIN)\n  console.log(\"Metric Below:\",metricBAVG/i2B)\n  console.log(\"Metric Average:\",metricAVG/sampleCount)\n  console.log(\"Metric Above:\",metricAAVG/i2A)\n  console.log(\"Metric Change:\",percentChangeMetric)\n  console.log(\"Predicted Metric:\",predictedMetric)\n  if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n  if (($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric>3) return \"🔴\";\n  if (($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric<-3) return \"🟢\";\n  return \"🟡\"\n}","visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","recordField":"element"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"Diff","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1701281148734}]}},"22":{"type":"code","title":"Overall Health","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  var metric = $KPI;\n  const metricAgg = \"avg\";\n  var condition = \"\";\n  var chartInterval = \"1m\";\n  var healthCount = 0;\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  var i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  // Duration Health\n  var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n  if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n  if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n  if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n  var response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n  if (response.values.length<6) return \"Try increasing the timeframe.\";\n  var sampleCount = response.values.length-6;\n  let percentChangeMetric = 0;\n  let percentChangeTraffic = 0;\n  let trafficAVG = 0;\n  let metricAVG = 0;\n  let metricMIN = response.values[0][2];\n  let metricAAVG = 0;\n  let metricBAVG = 0;\n  let trafficAAVG = 0;\n  let trafficBAVG = 0;\n  let c = 0;\n  while (c < sampleCount) {\n    trafficAVG = trafficAVG + response.values[c][1];\n    metricAVG = metricAVG + response.values[c][2];\n    if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n    c++;\n  }\n  let i2 = 0;\n  let i2A = 0;\n  let i2B = 0;\n    while (i2 < sampleCount) {\n          if (response.values[i2][1]>(trafficAVG/sampleCount))\n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricAAVG=metricAAVG+response.values[i2][2];\n              trafficAAVG=trafficAAVG+response.values[i2][1];\n              i2A++;\n                  }\n            }\n          if (response.values[i2][1]<(trafficAVG/sampleCount)) \n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricBAVG=metricBAVG+response.values[i2][2];\n              trafficBAVG=trafficBAVG+response.values[i2][1];\n              i2B++;\n                  }\n            }\n          i2++;\n        }\n  percentChangeMetric = (Number(metricAAVG/i2A) - Number(metricBAVG/i2B))/Number(metricBAVG/i2B)*100;\n  percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n  var predictedMetric=(metricAVG/sampleCount) + (metricAVG/sampleCount*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n  if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n  if (($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric>3) healthCount=healthCount+1;\n  if (($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric>-3) healthCount=healthCount+1;\n  // End Duration Health\n  // Request Health\n  metric=\"requesterrorcount\";\n  var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", sum('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n  if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", sum('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n  if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", sum('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n  if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", sum('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n  response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n  if (response.values.length<24) return \"Try increasing the timeframe.\";\n  // Toss last 30 minutes\n  sampleCount = response.values.length-6;\n  percentChangeMetric = 0;\n  percentChangeTraffic = 0;\n  trafficAVG = 0;\n  metricAVG = 0;\n  metricAAVG = 0;\n  metricBAVG = 0;\n  trafficAAVG = 0; \n  trafficBAVG = 0;\n  c = 0;\n  // Get traffic volume and summarize metric\n  while (c < sampleCount) {\n    trafficAVG = trafficAVG + response.values[c][1];\n    metricAVG = metricAVG + response.values[c][2];\n    c++;\n  }\n  i2 = 0;\n  i2A = 0;\n  i2B = 0;\n  // Bucket metric results (5 minute interval) into above/below traffic average\n  while (i2 < sampleCount) {\n    if (response.values[i2][1]>(trafficAVG/sampleCount))\n      {\n        metricAAVG=metricAAVG+response.values[i2][2];\n        trafficAAVG=trafficAAVG+response.values[i2][1];\n        i2A++;\n      }\n    if (response.values[i2][1]<(trafficAVG/sampleCount)) \n      {\n        metricBAVG=metricBAVG+response.values[i2][2];\n        trafficBAVG=trafficBAVG+response.values[i2][1];\n        i2B++;\n      }\n    i2++;\n  }\n  percentChangeMetric = ((Number(metricAAVG/i2A) - Number(metricBAVG/i2B))/Number(metricBAVG/i2B))*100;\n  if ((percentChangeMetric+((percentChangeMetric*$TrafficChangePercent/100)))>3) healthCount=healthCount+2;\n  if ((percentChangeMetric+((percentChangeMetric*$TrafficChangePercent/100)))>0) healthCount=healthCount+1;\n  // End Request Health\n  // JS Health\n  metric=\"javascripterrorcount\";\n  usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", sum('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n  if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", sum('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n  if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", sum('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n  if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", sum('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n  response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n  if (response.values.length<24) return \"Try increasing the timeframe.\";\n  // Toss last 30 minutes\n  sampleCount = response.values.length-6;\n  percentChangeMetric = 0;\n  percentChangeTraffic = 0;\n  trafficAVG = 0;\n  metricAVG = 0;\n  metricAAVG = 0;\n  metricBAVG = 0;\n  trafficAAVG = 0;\n  trafficBAVG = 0;\n  c = 0;\n  // Get traffic volume and summarize metric\n  while (c < sampleCount) {\n    trafficAVG = trafficAVG + response.values[c][1];\n    metricAVG = metricAVG + response.values[c][2];\n    c++;\n  }\n  i2 = 0;\n  i2A = 0;\n  i2B = 0;\n  // Bucket metric results (5 minute interval) into above/below traffic average\n  while (i2 < sampleCount) {\n    if (response.values[i2][1]>(trafficAVG/sampleCount))\n      {\n        metricAAVG=metricAAVG+response.values[i2][2];\n        trafficAAVG=trafficAAVG+response.values[i2][1];\n        i2A++;\n      }\n    if (response.values[i2][1]<(trafficAVG/sampleCount)) \n      {\n        metricBAVG=metricBAVG+response.values[i2][2];\n        trafficBAVG=trafficBAVG+response.values[i2][1];\n        i2B++;\n      }\n    i2++;\n  }\n  percentChangeMetric = ((Number(metricAAVG/i2A) - Number(metricBAVG/i2B))/Number(metricBAVG/i2B))*100;\n  if ((percentChangeMetric+((percentChangeMetric*$TrafficChangePercent/100)))>3) healthCount=healthCount+2;\n  if ((percentChangeMetric+((percentChangeMetric*$TrafficChangePercent/100)))>0) healthCount=healthCount+1;\n  // End JS Health\n  //  return health status icon\n  if (healthCount>1) return \"🔴\";\n  if (healthCount>0) return \"🟡\";\n  return \"🟢\"\n}","visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","recordField":"element"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"Diff","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1701281148734}]}},"24":{"type":"code","title":"Request Error Rate Distribution Below/Above Traffic Average","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = \"requestErrorCount\";\n  const metricName = \"Error Count\";\n  const metricAgg = \"sum\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n  if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n  if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n  if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n  const response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n  if (response.values.length<6) return \"Try increasing the timeframe.\";\n  const sampleCount = response.values.length-6;\n  let percentChangeMetric = 0;\n  let percentChangeTraffic = 0;\n  let trafficAVG = 0;\n  let metricAVG = 0;\n  let metricMIN = response.values[0][2];\n  let metricAAVG = 0;\n  let metricBAVG = 0;\n  let trafficAAVG = 0;\n  let trafficBAVG = 0;\n  let c = 0;\n  while (c < sampleCount) {\n    trafficAVG = trafficAVG + response.values[c][1];\n    metricAVG = metricAVG + response.values[c][2];\n    if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n    c++;\n  }\n  let i2 = 0;\n  let i2A = 0;\n  let i2B = 0;\n    while (i2 < sampleCount) {\n          if (response.values[i2][1]>(trafficAVG/sampleCount))\n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricAAVG=metricAAVG+response.values[i2][2];\n              trafficAAVG=trafficAAVG+response.values[i2][1];\n              i2A++;\n                  }\n            }\n          if (response.values[i2][1]<(trafficAVG/sampleCount)) \n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricBAVG=metricBAVG+response.values[i2][2];\n              trafficBAVG=trafficBAVG+response.values[i2][1];\n              i2B++;\n                  }\n            }\n          i2++;\n        }\nreturn {\n    records: [\n     {\n        'Traffic': \"Below Average\",\n        'Errors': metricBAVG/i2B\n      },\n    {   'Traffic': \"Average\",\n        'Errors': metricAVG/sampleCount\n      },\n    {   'Traffic': \"Above Average\",\n        'Errors': metricAAVG/i2A\n      },\n],\n    types: [\n      {\n        indexRange: [0, 2],\n        mappings: {\n          'Traffic': { type: 'string' },\n          'Errors': { type: 'double' }\n        },\n      },\n    ],\n  };\n}","visualization":"categoricalBarChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{"Below Average":{"color":"#00D26A","added":1702149388683},"Above Average":{"color":"#F8312F","added":1702149391362},"Average":{"color":"#FCD53F","added":1702149394566}},"categoricalBarChartSettings":{"categoryAxis":"Traffic","categoryAxisLabel":"Traffic","valueAxis":"Errors","valueAxisLabel":"Errors"},"legend":{"hidden":true}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","recordField":"Traffic"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}}}},"25":{"type":"code","title":"JavaScript Error Rate Distribution Below/Above Traffic Average","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = \"javascriptErrorCount\";\n  const metricName = \"Error Count\";\n  const metricAgg = \"sum\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n  if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n  if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n  if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n  const response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n  if (response.values.length<6) return \"Try increasing the timeframe.\";\n  const sampleCount = response.values.length-6;\n  let percentChangeMetric = 0;\n  let percentChangeTraffic = 0;\n  let trafficAVG = 0;\n  let metricAVG = 0;\n  let metricMIN = response.values[0][2];\n  let metricAAVG = 0;\n  let metricBAVG = 0;\n  let trafficAAVG = 0;\n  let trafficBAVG = 0;\n  let c = 0;\n  while (c < sampleCount) {\n    trafficAVG = trafficAVG + response.values[c][1];\n    metricAVG = metricAVG + response.values[c][2];\n    if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n    c++;\n  }\n  let i2 = 0;\n  let i2A = 0;\n  let i2B = 0;\n    while (i2 < sampleCount) {\n          if (response.values[i2][1]>(trafficAVG/sampleCount))\n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricAAVG=metricAAVG+response.values[i2][2];\n              trafficAAVG=trafficAAVG+response.values[i2][1];\n              i2A++;\n                  }\n            }\n          if (response.values[i2][1]<(trafficAVG/sampleCount)) \n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricBAVG=metricBAVG+response.values[i2][2];\n              trafficBAVG=trafficBAVG+response.values[i2][1];\n              i2B++;\n                  }\n            }\n          i2++;\n        }\nreturn {\n    records: [\n     {\n        'Traffic': \"Below Average\",\n        'Errors': metricBAVG/i2B\n      },\n    {   'Traffic': \"Average\",\n        'Errors': metricAVG/sampleCount\n      },\n    {   'Traffic': \"Above Average\",\n        'Errors': metricAAVG/i2A\n      },\n],\n    types: [\n      {\n        indexRange: [0, 2],\n        mappings: {\n          'Traffic': { type: 'string' },\n          'Errors': { type: 'double' }\n        },\n      },\n    ],\n  };\n}","visualization":"categoricalBarChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{"Below Average":{"color":"#00D26A","added":1702149388683},"Above Average":{"color":"#F8312F","added":1702149391362},"Average":{"color":"#FCD53F","added":1702149394566}},"categoricalBarChartSettings":{"categoryAxis":"Traffic","categoryAxisLabel":"Traffic","valueAxis":"Errors","valueAxisLabel":"Errors"},"legend":{"hidden":true}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","recordField":"Traffic"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}}}},"32":{"type":"markdown","title":"","content":"![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABy8AAAAMCAYAAADbJPG3AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAACdSURBVHhe7dtBFcAgDETBUBtFA6KrDhf0gofsYeay8fBfRn37FAAAAAAAAECz5y4AAAAAAABAK/ESAAAAAAAAiCBeAgAAAAAAABHESwAAAAAAACCCeAkAAAAAAABEEC8BAAAAAACACOIlAAAAAAAAEGG8c517AwAAAAAAALTxeQkAAAAAAABEEC8BAAAAAACACOIlAAAAAAAAEKDqB2IIBAQ2TEouAAAAAElFTkSuQmCC)"},"35":{"type":"code","title":"Traffic Impact on User Action $KPI","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = $KPI;\n  const metricName = \"Avg Duration\";\n  const metricAgg = \"avg\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  // Get useraction names\n  var usqlQueryActions = 'SELECT DISTINCT name,'+metricAgg+'('+metric+') as D1,count(*),min('+metric+') from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' order by count(*) DESC limit 5000';\n  if ($ActionCategory==\"Key\") usqlQueryActions = 'SELECT DISTINCT name,'+metricAgg+'('+metric+'),count(*),min('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n  if ($ActionCategory==\"Entry\") usqlQueryActions = 'SELECT DISTINCT name,'+metricAgg+'('+metric+'),count(*),min('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n  if ($ActionCategory==\"Exit\") usqlQueryActions = 'SELECT DISTINCT name,'+metricAgg+'('+metric+'),count(*),min('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n  const responseActions = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQueryActions, startTimestamp: startTime, endTimestamp: endTime});\n  // Loop thru each useraction\n  for (var actions = 0; actions < responseActions.values.length; actions++) {\n        responseActions.values[actions][0] = responseActions.values[actions][0].replace(/\"/g, \"\\\"\\\"\");\n        // Get traffic and metric details\n        var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION ('+metricAgg+'('+metric+'), where name=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n        if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION ('+metricAgg+'('+metric+'), where name=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n        if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION ('+metricAgg+'('+metric+'), where name=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n        if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION ('+metricAgg+'('+metric+'), where name=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n        var response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n        // Toss last 30 minutes\n        var sampleCount = response.values.length-6;\n\n  let percentChangeMetric = 0;\n  let percentChangeTraffic = 0;\n  let trafficAVG = 0;\n  let metricAVG = 0;\n  let metricMIN = response.values[0][2];\n  let metricAAVG = 0;\n  let metricBAVG = 0;\n  let trafficAAVG = 0;\n  let trafficBAVG = 0;\n  let c = 0;\n  while (c < sampleCount) {\n    trafficAVG = trafficAVG + response.values[c][1];\n    metricAVG = metricAVG + response.values[c][2];\n    if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n    c++;\n  }\n  let i2 = 0;\n  let i2A = 0;\n  let i2B = 0;\n    while (i2 < sampleCount) {\n          if (response.values[i2][1]>(trafficAVG/sampleCount))\n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricAAVG=metricAAVG+response.values[i2][2];\n              trafficAAVG=trafficAAVG+response.values[i2][1];\n              i2A++;\n                  }\n            }\n          if (response.values[i2][1]<(trafficAVG/sampleCount)) \n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricBAVG=metricBAVG+response.values[i2][2];\n              trafficBAVG=trafficBAVG+response.values[i2][1];\n              i2B++;\n                  }\n            }\n          i2++;\n        }\n  percentChangeMetric = (Number(metricAAVG/i2A) - Number(metricBAVG/i2B))/Number(metricBAVG/i2B)*100;\n  percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n  var predictedMetric=(metricAVG/sampleCount) + (metricAVG/sampleCount*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n  if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n\n    responseActions.values[actions][1]=metricAVG/sampleCount;    \n    responseActions.values[actions][4]=predictedMetric;\n    }\n  \n    return {\n    records: new Array(responseActions.values.length).fill(null).map((_, index, array) => {\n      return {\n        'User Action': responseActions.values[index][0],\n        'Count': responseActions.values[index][2],\n        'Performance': responseActions.values[index][1].toFixed(2)+0,\n        'Prediction': responseActions.values[index][4]+0,\n        'Change': (responseActions.values[index][4]-responseActions.values[index][1]).toFixed(2)+0,\n        'Impact': ((responseActions.values[index][4]-responseActions.values[index][1])*responseActions.values[index][2]).toFixed(2)+0\n\n      };\n    }),\n    types: [\n      {\n        indexRange: [0, sampleCount],\n        mappings: {\n          'User Action': { type: 'string' },\n          'Count': { type: 'double' },\n          'Performance': { type: 'double' },\n          'Prediction': { type: 'double' },\n          'Change': { type: 'double' },\n          'Impact': { type: 'double' }\n        },\n      },\n    ],\n  };\n}","visualization":"table","visualizationSettings":{"thresholds":[{"id":1,"field":"Duration","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":0},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":3000},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":6000}]},{"id":2,"field":"Prediction","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":0},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":3000},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":6000}]},{"id":3,"field":"Change","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":-99999999999},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":0},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":2000}]},{"id":4,"field":"Impact","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":-99999999999},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":0},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":200000}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"User Action","categoryAxisLabel":"User Action","valueAxis":"Count","valueAxisLabel":"Count"}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"start","recordField":"User Action"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"User Action\"]":283,"[\"Count\"]":102.48124694824219,"[\"Duration\"]":114.01249694824219,"[\"Prediction\"]":126.66874694824219,"[\"Change\"]":141.73749542236328,"[\"Impact\"]":93.74999237060547},"sortBy":{"columnId":"[\"Impact\"]","direction":"descending"}},"unitsOverrides":[{"identifier":"Prediction","unitCategory":"time","baseUnit":"millisecond","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1701281148734},{"identifier":"Duration","unitCategory":"time","baseUnit":"millisecond","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1704583008650},{"identifier":"Change","unitCategory":"time","baseUnit":"millisecond","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1704583201091},{"identifier":"Count","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1704909346634},{"identifier":"Impact","unitCategory":"time","baseUnit":"millisecond","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1705510501558}]}},"36":{"type":"code","title":"Traffic Impact on $LocationFilter $KPI","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = $KPI;\n  const metricName = \"Avg Duration\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  // Get locations\n  var usqlQueryActions = 'SELECT DISTINCT usersession.'+$LocationFilter+',avg('+metric+') as D1,count(*),min('+metric+') from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$LocationFilter+' is not null order by count(*) DESC limit 500';\n  if ($ActionCategory==\"Key\") usqlQueryActions = 'SELECT DISTINCT usersession.'+$LocationFilter+',avg('+metric+') as D1,count(*),min('+metric+') from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$LocationFilter+' is not null and keyuseraction is true order by count(*) DESC limit 500';\n  if ($ActionCategory==\"Entry\") usqlQueryActions = 'SELECT DISTINCT usersession.'+$LocationFilter+',avg('+metric+') as D1,count(*),min('+metric+') from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$LocationFilter+' is not null and isentryaction is true order by count(*) DESC limit 500';\n  if ($ActionCategory==\"Exit\") usqlQueryActions = 'SELECT DISTINCT usersession.'+$LocationFilter+',avg('+metric+') as D1,count(*),min('+metric+') from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$LocationFilter+' is not null and isexitaction is true order by count(*) DESC limit 500';\n  const responseActions = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQueryActions, startTimestamp: startTime, endTimestamp: endTime});\n  // Loop thru each useraction\n  for (var actions = 0; actions < responseActions.values.length; actions++) {\n        responseActions.values[actions][0] = responseActions.values[actions][0].replace(/\"/g, \"\\\"\\\"\");\n        // Get traffic and metric details\n        var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (avg('+metric+'), where usersession.'+$LocationFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n        if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (avg('+metric+'), where usersession.'+$LocationFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n        if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (avg('+metric+'), where usersession.'+$LocationFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n        if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (avg('+metric+'), where usersession.'+$LocationFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n        var response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n        // Toss last 30 minutes\n        var sampleCount = response.values.length-6;\n\n  let percentChangeMetric = 0;\n  let percentChangeTraffic = 0;\n  let trafficAVG = 0;\n  let metricAVG = 0;\n  let metricMIN = response.values[0][2];\n  let metricAAVG = 0;\n  let metricBAVG = 0;\n  let trafficAAVG = 0;\n  let trafficBAVG = 0;\n  let c = 0;\n  while (c < sampleCount) {\n    trafficAVG = trafficAVG + response.values[c][1];\n    metricAVG = metricAVG + response.values[c][2];\n    if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n    c++;\n  }\n  let i2 = 0;\n  let i2A = 0;\n  let i2B = 0;\n    while (i2 < sampleCount) {\n          if (response.values[i2][1]>(trafficAVG/sampleCount))\n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricAAVG=metricAAVG+response.values[i2][2];\n              trafficAAVG=trafficAAVG+response.values[i2][1];\n              i2A++;\n                  }\n            }\n          if (response.values[i2][1]<(trafficAVG/sampleCount)) \n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricBAVG=metricBAVG+response.values[i2][2];\n              trafficBAVG=trafficBAVG+response.values[i2][1];\n              i2B++;\n                  }\n            }\n          i2++;\n        }\n  percentChangeMetric = (Number(metricAAVG/i2A) - Number(metricBAVG/i2B))/Number(metricBAVG/i2B)*100;\n  percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n  var predictedMetric=(metricAVG/sampleCount) + (metricAVG/sampleCount*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n/*  console.log(\"Traffic Below:\",trafficBAVG/i2B)\n  console.log(\"Traffic Average:\",trafficAVG/sampleCount)\n  console.log(\"Traffic Above:\",trafficAAVG/i2A)\n  console.log(\"Traffic Change:\",percentChangeTraffic)\n  console.log(\"Metric Min:\",metricMIN)\n  console.log(\"Metric Below:\",metricBAVG/i2B)\n  console.log(\"Metric Average:\",metricAVG/sampleCount)\n  console.log(\"Metric Above:\",metricAAVG/i2A)\n  console.log(\"Metric Change:\",percentChangeMetric)\n  console.log(\"Predicted Metric:\",predictedMetric)*/\n  if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n\n    responseActions.values[actions][1]=metricAVG/sampleCount;\n    responseActions.values[actions][4]=predictedMetric;\n    }\n  \n    return {\n    records: new Array(responseActions.values.length).fill(null).map((_, index, array) => {\n      return {\n        'Location': responseActions.values[index][0],\n        'Count': responseActions.values[index][2],\n        'Performance': responseActions.values[index][1].toFixed(2)+0,\n        'Prediction': responseActions.values[index][4]+0,\n        'Change': (responseActions.values[index][4]-responseActions.values[index][1]).toFixed(2)+0,\n        'Impact': ((responseActions.values[index][4]-responseActions.values[index][1])*responseActions.values[index][2]).toFixed(2)+0\n\n      };\n    }),\n    types: [\n      {\n        indexRange: [0, sampleCount],\n        mappings: {\n          'Location': { type: 'string' },\n          'Count': { type: 'double' },\n          'Performance': { type: 'double' },\n          'Prediction': { type: 'double' },\n          'Change': { type: 'double' },\n          'Impact': { type: 'double' }\n        },\n      },\n    ],\n  };\n}","visualization":"table","visualizationSettings":{"thresholds":[{"id":1,"field":"Duration","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":0},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":3000},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":6000}]},{"id":2,"field":"Prediction","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":0},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":3000},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":6000}]},{"id":3,"field":"Change","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":-99999999999},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":0},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":2000}]},{"id":4,"field":"Impact","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":-99999999999},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":0},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":200000}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"Location","categoryAxisLabel":"Location","valueAxis":"Count","valueAxisLabel":"Count"}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"start","recordField":"Location"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{},"sortBy":{"columnId":"[\"Impact\"]","direction":"descending"}},"unitsOverrides":[{"identifier":"Prediction","unitCategory":"time","baseUnit":"millisecond","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1701281148734},{"identifier":"Duration","unitCategory":"time","baseUnit":"millisecond","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1704583008650},{"identifier":"Change","unitCategory":"time","baseUnit":"millisecond","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1704583201091},{"identifier":"Count","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1704909346634},{"identifier":"Impact","unitCategory":"time","baseUnit":"millisecond","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1705509269149}]}},"37":{"type":"code","title":"Traffic Impact on $EnvironmentFilter $KPI","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = $KPI;\n  const metricName = \"Avg Duration\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  // Get env data\n  var usqlQueryActions = 'SELECT DISTINCT usersession.'+$EnvironmentFilter+',avg('+metric+') as D1,count(*),min('+metric+') from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$EnvironmentFilter+' is not null order by count(*) DESC limit 500';\n  if ($ActionCategory==\"Key\") usqlQueryActions = 'SELECT DISTINCT usersession.'+$EnvironmentFilter+',avg('+metric+') as D1,count(*),min('+metric+') from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$EnvironmentFilter+' is not null and keyuseraction is true order by count(*) DESC limit 500';\n  if ($ActionCategory==\"Entry\") usqlQueryActions = 'SELECT DISTINCT usersession.'+$EnvironmentFilter+',avg('+metric+') as D1,count(*),min('+metric+') from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$EnvironmentFilter+' is not null and isentryaction is true order by count(*) DESC limit 500';\n  if ($ActionCategory==\"Exit\") usqlQueryActions = 'SELECT DISTINCT usersession.'+$EnvironmentFilter+',avg('+metric+') as D1,count(*),min('+metric+') from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$EnvironmentFilter+' is not null and isexitaction is true order by count(*) DESC limit 500';\n  const responseActions = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQueryActions, startTimestamp: startTime, endTimestamp: endTime});\n  // Loop thru each useraction\n  for (var actions = 0; actions < responseActions.values.length; actions++) {\n        responseActions.values[actions][0] = responseActions.values[actions][0].replace(/\"/g, \"\\\"\\\"\");\n        // Get traffic and metric details\n        var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (avg('+metric+'), where usersession.'+$EnvironmentFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n        if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (avg('+metric+'), where usersession.'+$EnvironmentFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n        if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (avg('+metric+'), where usersession.'+$EnvironmentFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n        if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (avg('+metric+'), where usersession.'+$EnvironmentFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n        var response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n        // Toss last 30 minutes\n        var sampleCount = response.values.length-6;\n\n  let percentChangeMetric = 0;\n  let percentChangeTraffic = 0;\n  let trafficAVG = 0;\n  let metricAVG = 0;\n  let metricMIN = response.values[0][2];\n  let metricAAVG = 0;\n  let metricBAVG = 0;\n  let trafficAAVG = 0;\n  let trafficBAVG = 0;\n  let c = 0;\n  while (c < sampleCount) {\n    trafficAVG = trafficAVG + response.values[c][1];\n    metricAVG = metricAVG + response.values[c][2];\n    if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n    c++;\n  }\n  let i2 = 0;\n  let i2A = 0;\n  let i2B = 0;\n    while (i2 < sampleCount) {\n          if (response.values[i2][1]>(trafficAVG/sampleCount))\n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricAAVG=metricAAVG+response.values[i2][2];\n              trafficAAVG=trafficAAVG+response.values[i2][1];\n              i2A++;\n                  }\n            }\n          if (response.values[i2][1]<(trafficAVG/sampleCount)) \n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricBAVG=metricBAVG+response.values[i2][2];\n              trafficBAVG=trafficBAVG+response.values[i2][1];\n              i2B++;\n                  }\n            }\n          i2++;\n        }\n  percentChangeMetric = (Number(metricAAVG/i2A) - Number(metricBAVG/i2B))/Number(metricBAVG/i2B)*100;\n  percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n  var predictedMetric=(metricAVG/sampleCount) + (metricAVG/sampleCount*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n  if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n\n    responseActions.values[actions][1]=metricAVG/sampleCount;\n    responseActions.values[actions][4]=predictedMetric;\n    }\n  \n    return {\n    records: new Array(responseActions.values.length).fill(null).map((_, index, array) => {\n      return {\n        'Environment': responseActions.values[index][0],\n        'Count': responseActions.values[index][2],\n        'Performance': responseActions.values[index][1].toFixed(2)+0,\n        'Prediction': responseActions.values[index][4]+0,\n        'Change': (responseActions.values[index][4]-responseActions.values[index][1]).toFixed(2)+0,\n        'Impact': ((responseActions.values[index][4]-responseActions.values[index][1])*responseActions.values[index][2]).toFixed(2)+0\n\n      };\n    }),\n    types: [\n      {\n        indexRange: [0, sampleCount],\n        mappings: {\n          'Environment': { type: 'string' },\n          'Count': { type: 'double' },\n          'Performance': { type: 'double' },\n          'Prediction': { type: 'double' },\n          'Change': { type: 'double' },\n          'Impact': { type: 'double' }\n        },\n      },\n    ],\n  };\n}","visualization":"table","visualizationSettings":{"thresholds":[{"id":1,"field":"Duration","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":0},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":3000},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":6000}]},{"id":2,"field":"Prediction","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":0},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":3000},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":6000}]},{"id":3,"field":"Change","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":-99999999999},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":0},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":2000}]},{"id":4,"field":"Impact","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":-99999999999},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":0},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":200000}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"Environment","categoryAxisLabel":"Environment","valueAxis":"Count","valueAxisLabel":"Count"}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"start","recordField":"Environment"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"Prediction","unitCategory":"time","baseUnit":"millisecond","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1701281148734},{"identifier":"Duration","unitCategory":"time","baseUnit":"millisecond","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1704583008650},{"identifier":"Change","unitCategory":"time","baseUnit":"millisecond","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1704583201091},{"identifier":"Count","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1704909346634},{"identifier":"Impact","unitCategory":"time","baseUnit":"millisecond","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1705509269149}]}},"39":{"type":"code","title":"Traffic Impact on $EnvironmentFilter Request Errors","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = \"requestErrorCount\";\n  const metricName = \"Error Rate\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  // Get Locations\n  var usqlQueryActions = 'SELECT DISTINCT usersession.'+$EnvironmentFilter+',sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$EnvironmentFilter+' is not null order by D1 DESC limit 100';\n  if ($ActionCategory==\"Key\") usqlQueryActions = 'SELECT DISTINCT usersession.'+$EnvironmentFilter+',sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$EnvironmentFilter+' is not null and keyuseraction is true limit 100';\n  if ($ActionCategory==\"Entry\") usqlQueryActions = 'SELECT DISTINCT usersession.'+$EnvironmentFilter+',sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$EnvironmentFilter+' is not null and isentryaction is true  limit 100';\n  if ($ActionCategory==\"Exit\") usqlQueryActions = 'SELECT DISTINCT usersession.'+$EnvironmentFilter+',sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$EnvironmentFilter+' is not null and isexitaction is true limit 100';\n  const responseActions = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQueryActions, startTimestamp: startTime, endTimestamp: endTime});\n  // Loop thru each Location\n  for (var actions = 0; actions < responseActions.values.length; actions++) {\n        responseActions.values[actions][0] = responseActions.values[actions][0].replace(/\"/g, \"\\\"\\\"\");\n        // Get traffic and metric details\n        var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where usersession.'+$EnvironmentFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n        if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where usersession.'+$EnvironmentFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n        if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where usersession.'+$EnvironmentFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n        if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where usersession.'+$EnvironmentFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n        var response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n        // Toss last 30 minutes\n        var sampleCount = response.values.length-6;\n        let percentChangeMetric = 0;\n        let percentChangeTraffic = 0;\n        let trafficAVG = 0;\n        let metricAVG = 0;\n        let metricMIN = response.values[0][2];\n        let metricAAVG = 0;\n        let metricBAVG = 0;\n        let trafficAAVG = 0;\n        let trafficBAVG = 0;\n        let c = 0;\n        while (c < sampleCount) {\n          trafficAVG = trafficAVG + response.values[c][1];\n          metricAVG = metricAVG + response.values[c][2];\n          if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n          c++;\n        }\n        let i2 = 0;\n        let i2A = 0;\n        let i2B = 0;\n          while (i2 < sampleCount) {\n                if (response.values[i2][1]>(trafficAVG/sampleCount))\n                  {\n                    if (response.values[i2][2]!=null)\n                      {\n                    metricAAVG=metricAAVG+response.values[i2][2];\n                    trafficAAVG=trafficAAVG+response.values[i2][1];\n                    i2A++;\n                        }\n                  }\n                if (response.values[i2][1]<(trafficAVG/sampleCount)) \n                  {\n                    if (response.values[i2][2]!=null)\n                      {\n                    metricBAVG=metricBAVG+response.values[i2][2];\n                    trafficBAVG=trafficBAVG+response.values[i2][1];\n                    i2B++;\n                        }\n                  }\n                i2++;\n              }\n        if (metricBAVG==0) metricBAVG=1;\n        percentChangeMetric = (Number(metricAAVG) - Number(metricBAVG))/Number(metricBAVG);\n        percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n        var predictedMetric=(metricAVG) + (metricAVG*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n        if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n        responseActions.values[actions][1]=metricAVG;\n        responseActions.values[actions][2]=predictedMetric;\n    }\n  \n    return {\n    records: new Array(responseActions.values.length).fill(null).map((_, index, array) => {\n      return {\n        'Environment': responseActions.values[index][0],\n        'Errors': responseActions.values[index][1],\n        'Prediction': responseActions.values[index][2],\n        'Change': responseActions.values[index][2]-responseActions.values[index][1]\n      };\n    }),\n    types: [\n      {\n        indexRange: [0, sampleCount],\n        mappings: {\n          'Environment': { type: 'string' },\n          'Errors': { type: 'double' },\n          'Prediction': { type: 'double' },\n          'Change': { type: 'double' }\n        },\n      },\n    ],\n  };\n}","visualization":"table","visualizationSettings":{"thresholds":[{"id":1,"field":"Errors","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":0},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":0.5},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":1}]},{"id":2,"field":"Prediction","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":0},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":0.5},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":1}]},{"id":3,"field":"Change","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":-99999999},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":0.05},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":0.1}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"User Action","categoryAxisLabel":"User Action","valueAxis":"Avg Duration","valueAxisLabel":"Avg Duration"}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"start","recordField":"Environment"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"User Action\"]":272.84375,"[\"Errors\"]":87.875,"[\"Prediction\"]":112.734375,"[\"Change\"]":95.796875}},"unitsOverrides":[{"identifier":"Prediction","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1701281148734},{"identifier":"Errors","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1704583008650},{"identifier":"Change","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1704583201091}]}},"40":{"type":"code","title":"Traffic Impact on $LocationFilter JavaScript Error Rate","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = \"javascriptErrorCount\";\n  const metricName = \"Error Rate\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  // Get Locations\n  var usqlQueryActions = 'SELECT DISTINCT usersession.'+$LocationFilter+',sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$LocationFilter+' is not null order by D1 DESC limit 100';\n  if ($ActionCategory==\"Key\") usqlQueryActions = 'SELECT DISTINCT usersession.'+$LocationFilter+',sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$LocationFilter+' is not null and keyuseraction is true limit 100';\n  if ($ActionCategory==\"Entry\") usqlQueryActions = 'SELECT DISTINCT usersession.'+$LocationFilter+',sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$LocationFilter+' is not null and isentryaction is true  limit 100';\n  if ($ActionCategory==\"Exit\") usqlQueryActions = 'SELECT DISTINCT usersession.'+$LocationFilter+',sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$LocationFilter+' is not null and isexitaction is true limit 100';\n  const responseActions = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQueryActions, startTimestamp: startTime, endTimestamp: endTime});\n  // Loop thru each Location\n  for (var actions = 0; actions < responseActions.values.length; actions++) {\n        responseActions.values[actions][0] = responseActions.values[actions][0].replace(/\"/g, \"\\\"\\\"\");\n        // Get traffic and metric details\n        var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where usersession.'+$LocationFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n        if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where usersession.'+$LocationFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n        if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where usersession.'+$LocationFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n        if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where usersession.'+$LocationFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n        var response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n        // Toss last 30 minutes\n        var sampleCount = response.values.length-6;\n        let percentChangeMetric = 0;\n        let percentChangeTraffic = 0;\n        let trafficAVG = 0;\n        let metricAVG = 0;\n        let metricMIN = response.values[0][2];\n        let metricAAVG = 0;\n        let metricBAVG = 0;\n        let trafficAAVG = 0;\n        let trafficBAVG = 0;\n        let c = 0;\n        while (c < sampleCount) {\n          trafficAVG = trafficAVG + response.values[c][1];\n          metricAVG = metricAVG + response.values[c][2];\n          if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n          c++;\n        }\n        let i2 = 0;\n        let i2A = 0;\n        let i2B = 0;\n          while (i2 < sampleCount) {\n                if (response.values[i2][1]>(trafficAVG/sampleCount))\n                  {\n                    if (response.values[i2][2]!=null)\n                      {\n                    metricAAVG=metricAAVG+response.values[i2][2];\n                    trafficAAVG=trafficAAVG+response.values[i2][1];\n                    i2A++;\n                        }\n                  }\n                if (response.values[i2][1]<(trafficAVG/sampleCount)) \n                  {\n                    if (response.values[i2][2]!=null)\n                      {\n                    metricBAVG=metricBAVG+response.values[i2][2];\n                    trafficBAVG=trafficBAVG+response.values[i2][1];\n                    i2B++;\n                        }\n                  }\n                i2++;\n              }\n        if (metricBAVG==0) metricBAVG=1;\n        percentChangeMetric = (Number(metricAAVG) - Number(metricBAVG))/Number(metricBAVG);\n        percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n        var predictedMetric=(metricAVG) + (metricAVG*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n        if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n        responseActions.values[actions][1]=metricAVG;\n        responseActions.values[actions][2]=predictedMetric;\n  console.log(\"Traffic Below:\",trafficBAVG/i2B)\n  console.log(\"Traffic Average:\",trafficAVG/sampleCount)\n  console.log(\"Traffic Above:\",trafficAAVG/i2A)\n  console.log(\"Traffic Change:\",percentChangeTraffic)\n  console.log(\"Metric Min:\",metricMIN)\n  console.log(\"Metric Below:\",metricBAVG)\n  console.log(\"Metric Average:\",metricAVG)\n  console.log(\"Metric Above:\",metricAAVG)\n  console.log(\"Metric Change:\",percentChangeMetric)\n  console.log(\"Predicted Metric:\",predictedMetric)\n    }\n  \n    return {\n    records: new Array(responseActions.values.length).fill(null).map((_, index, array) => {\n      return {\n        'Location': responseActions.values[index][0],\n        'Errors': responseActions.values[index][1],\n        'Prediction': responseActions.values[index][2],\n        'Change': responseActions.values[index][2]-responseActions.values[index][1]\n      };\n    }),\n    types: [\n      {\n        indexRange: [0, sampleCount],\n        mappings: {\n          'Location': { type: 'string' },\n          'Errors': { type: 'double' },\n          'Prediction': { type: 'double' },\n          'Change': { type: 'double' }\n        },\n      },\n    ],\n  };\n}","visualization":"table","visualizationSettings":{"thresholds":[{"id":1,"field":"Errors","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":0},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":0.5},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":1}]},{"id":2,"field":"Prediction","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":0},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":0.5},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":1}]},{"id":3,"field":"Change","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":-999999999},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":0.05},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":0.1}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"User Action","categoryAxisLabel":"User Action","valueAxis":"Avg Duration","valueAxisLabel":"Avg Duration"}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"start","recordField":"Location"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"User Action\"]":272.84375,"[\"Errors\"]":87.875,"[\"Prediction\"]":112.734375,"[\"Change\"]":95.796875}},"unitsOverrides":[{"identifier":"Prediction","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1701281148734},{"identifier":"Errors","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1704583008650},{"identifier":"Change","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1704583201091}]}},"42":{"type":"code","title":"Traffic Impact on $EnvironmentFilter JavaScript Error Rate","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = \"javascriptErrorCount\";\n  const metricName = \"Error Rate\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  // Get Locations\n  var usqlQueryActions = 'SELECT DISTINCT usersession.'+$EnvironmentFilter+',sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$EnvironmentFilter+' is not null order by D1 DESC limit 100';\n  if ($ActionCategory==\"Key\") usqlQueryActions = 'SELECT DISTINCT usersession.'+$EnvironmentFilter+',sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$EnvironmentFilter+' is not null and keyuseraction is true limit 100';\n  if ($ActionCategory==\"Entry\") usqlQueryActions = 'SELECT DISTINCT usersession.'+$EnvironmentFilter+',sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$EnvironmentFilter+' is not null and isentryaction is true  limit 100';\n  if ($ActionCategory==\"Exit\") usqlQueryActions = 'SELECT DISTINCT usersession.'+$EnvironmentFilter+',sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$EnvironmentFilter+' is not null and isexitaction is true limit 100';\n  const responseActions = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQueryActions, startTimestamp: startTime, endTimestamp: endTime});\n  // Loop thru each Location\n  for (var actions = 0; actions < responseActions.values.length; actions++) {\n        responseActions.values[actions][0] = responseActions.values[actions][0].replace(/\"/g, \"\\\"\\\"\");\n        // Get traffic and metric details\n        var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where usersession.'+$EnvironmentFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n        if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where usersession.'+$EnvironmentFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n        if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where usersession.'+$EnvironmentFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n        if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where usersession.'+$EnvironmentFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n        var response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n        // Toss last 30 minutes\n        var sampleCount = response.values.length-6;\n        let percentChangeMetric = 0;\n        let percentChangeTraffic = 0;\n        let trafficAVG = 0;\n        let metricAVG = 0;\n        let metricMIN = response.values[0][2];\n        let metricAAVG = 0;\n        let metricBAVG = 0;\n        let trafficAAVG = 0;\n        let trafficBAVG = 0;\n        let c = 0;\n        while (c < sampleCount) {\n          trafficAVG = trafficAVG + response.values[c][1];\n          metricAVG = metricAVG + response.values[c][2];\n          if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n          c++;\n        }\n        let i2 = 0;\n        let i2A = 0;\n        let i2B = 0;\n          while (i2 < sampleCount) {\n                if (response.values[i2][1]>(trafficAVG/sampleCount))\n                  {\n                    if (response.values[i2][2]!=null)\n                      {\n                    metricAAVG=metricAAVG+response.values[i2][2];\n                    trafficAAVG=trafficAAVG+response.values[i2][1];\n                    i2A++;\n                        }\n                  }\n                if (response.values[i2][1]<(trafficAVG/sampleCount)) \n                  {\n                    if (response.values[i2][2]!=null)\n                      {\n                    metricBAVG=metricBAVG+response.values[i2][2];\n                    trafficBAVG=trafficBAVG+response.values[i2][1];\n                    i2B++;\n                        }\n                  }\n                i2++;\n              }\n        if (metricBAVG==0) metricBAVG=1;\n        percentChangeMetric = (Number(metricAAVG) - Number(metricBAVG))/Number(metricBAVG);\n        percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n        var predictedMetric=(metricAVG) + (metricAVG*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n        if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n        responseActions.values[actions][1]=metricAVG;\n        responseActions.values[actions][2]=predictedMetric;\n    }\n  \n    return {\n    records: new Array(responseActions.values.length).fill(null).map((_, index, array) => {\n      return {\n        'Environment': responseActions.values[index][0],\n        'Errors': responseActions.values[index][1],\n        'Prediction': responseActions.values[index][2],\n        'Change': responseActions.values[index][2]-responseActions.values[index][1]\n      };\n    }),\n    types: [\n      {\n        indexRange: [0, sampleCount],\n        mappings: {\n          'Environment': { type: 'string' },\n          'Errors': { type: 'double' },\n          'Prediction': { type: 'double' },\n          'Change': { type: 'double' }\n        },\n      },\n    ],\n  };\n}","visualization":"table","visualizationSettings":{"thresholds":[{"id":1,"field":"Errors","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":0},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":0.5},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":1}]},{"id":2,"field":"Prediction","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":0},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":0.5},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":1}]},{"id":3,"field":"Change","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≥","label":"","value":-99999999},{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":0.05},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":0.1}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"User Action","categoryAxisLabel":"User Action","valueAxis":"Avg Duration","valueAxisLabel":"Avg Duration"}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"start","recordField":"Environment"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"User Action\"]":272.84375,"[\"Errors\"]":87.875,"[\"Prediction\"]":112.734375,"[\"Change\"]":95.796875}},"unitsOverrides":[{"identifier":"Prediction","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1701281148734},{"identifier":"Errors","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1704583008650},{"identifier":"Change","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1704583201091}]}},"43":{"type":"code","title":"Traffic Impact on User Action Request Errors","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = \"requestErrorCount\";\n  const metricName = \"Error Rate\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  // Get useraction names\n  var usqlQueryActions = 'SELECT DISTINCT name,sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' order by D1 DESC limit 100';\n  if ($ActionCategory==\"Key\") usqlQueryActions = 'SELECT DISTINCT name,sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 100';\n  if ($ActionCategory==\"Entry\") usqlQueryActions = 'SELECT DISTINCT name,sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 100';\n  if ($ActionCategory==\"Exit\") usqlQueryActions = 'SELECT DISTINCT name,sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 100';\n  const responseActions = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQueryActions, startTimestamp: startTime, endTimestamp: endTime});\n  // Loop thru each useraction\n  for (var actions = 0; actions < responseActions.values.length; actions++) {\n        responseActions.values[actions][0] = responseActions.values[actions][0].replace(/\"/g, \"\\\"\\\"\");\n        // Get traffic and metric details\n        var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where name=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n        if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where name=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n        if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where name=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n        if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where name=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n        var response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n        // Toss last 30 minutes\n        var sampleCount = response.values.length-6;\n        let percentChangeMetric = 0;\n        let percentChangeTraffic = 0;\n        let trafficAVG = 0;\n        let metricAVG = 0;\n        let metricMIN = response.values[0][2];\n        let metricAAVG = 0;\n        let metricBAVG = 0;\n        let trafficAAVG = 0;\n        let trafficBAVG = 0;\n        let c = 0;\n        while (c < sampleCount) {\n          trafficAVG = trafficAVG + response.values[c][1];\n          metricAVG = metricAVG + response.values[c][2];\n          if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n          c++;\n        }\n        let i2 = 0;\n        let i2A = 0;\n        let i2B = 0;\n          while (i2 < sampleCount) {\n                if (response.values[i2][1]>(trafficAVG/sampleCount))\n                  {\n                    if (response.values[i2][2]!=null)\n                      {\n                    metricAAVG=metricAAVG+response.values[i2][2];\n                    trafficAAVG=trafficAAVG+response.values[i2][1];\n                    i2A++;\n                        }\n                  }\n                if (response.values[i2][1]<(trafficAVG/sampleCount)) \n                  {\n                    if (response.values[i2][2]!=null)\n                      {\n                    metricBAVG=metricBAVG+response.values[i2][2];\n                    trafficBAVG=trafficBAVG+response.values[i2][1];\n                    i2B++;\n                        }\n                  }\n                i2++;\n              }\n        if (metricBAVG==0) metricBAVG=1;\n        percentChangeMetric = (Number(metricAAVG) - Number(metricBAVG))/Number(metricBAVG);\n        percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n        var predictedMetric=(metricAVG) + (metricAVG*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n        if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n        responseActions.values[actions][1]=metricAVG;\n        responseActions.values[actions][2]=predictedMetric;\n  console.log(\"Traffic Below:\",trafficBAVG/i2B)\n  console.log(\"Traffic Average:\",trafficAVG/sampleCount)\n  console.log(\"Traffic Above:\",trafficAAVG/i2A)\n  console.log(\"Traffic Change:\",percentChangeTraffic)\n  console.log(\"Metric Min:\",metricMIN)\n  console.log(\"Metric Below:\",metricBAVG)\n  console.log(\"Metric Average:\",metricAVG)\n  console.log(\"Metric Above:\",metricAAVG)\n  console.log(\"Metric Change:\",percentChangeMetric)\n  console.log(\"Predicted Metric:\",predictedMetric)\n    }\n  \n    return {\n    records: new Array(responseActions.values.length).fill(null).map((_, index, array) => {\n      return {\n        'User Action': responseActions.values[index][0],\n        'Errors': responseActions.values[index][1],\n        'Prediction': responseActions.values[index][2],\n        'Change': responseActions.values[index][2]-responseActions.values[index][1]\n      };\n    }),\n    types: [\n      {\n        indexRange: [0, sampleCount],\n        mappings: {\n          'User Action': { type: 'string' },\n          'Errors': { type: 'double' },\n          'Prediction': { type: 'double' },\n          'Change': { type: 'double' }\n        },\n      },\n    ],\n  };\n}","visualization":"table","visualizationSettings":{"thresholds":[{"id":1,"field":"Errors","title":"","isEnabled":true,"rules":[{"id":1,"color":"#FCD53F","comparator":">","label":"","value":0},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":5},{"id":3,"color":"#00D26A","comparator":"≤","label":"","value":0}]},{"id":2,"field":"Prediction","title":"","isEnabled":true,"rules":[{"id":1,"color":"#FCD53F","comparator":">","label":"","value":0},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":5},{"id":3,"color":"#00D26A","comparator":"≤","label":"","value":0}]},{"id":3,"field":"Change","title":"","isEnabled":true,"rules":[{"id":1,"color":"#FCD53F","comparator":">","label":"","value":0},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":5},{"id":3,"color":"#00D26A","comparator":"≤","label":"","value":0}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"User Action","categoryAxisLabel":"User Action","valueAxis":"Avg Duration","valueAxisLabel":"Avg Duration"}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"start","recordField":"User Action"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"User Action\"]":255,"[\"Errors\"]":87.875,"[\"Prediction\"]":112.734375,"[\"Change\"]":95.796875}},"unitsOverrides":[{"identifier":"Prediction","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1701281148734},{"identifier":"Errors","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1704583008650},{"identifier":"Change","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1704583201091}]}},"44":{"type":"code","title":"Traffic Impact on User Action JavaScript Errors","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = \"javascriptErrorCount\";\n  const metricName = \"Error Rate\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  // Get useraction names\n  var usqlQueryActions = 'SELECT DISTINCT name,sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' order by D1 DESC limit 100';\n  if ($ActionCategory==\"Key\") usqlQueryActions = 'SELECT DISTINCT name,sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 100';\n  if ($ActionCategory==\"Entry\") usqlQueryActions = 'SELECT DISTINCT name,sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 100';\n  if ($ActionCategory==\"Exit\") usqlQueryActions = 'SELECT DISTINCT name,sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 100';\n  const responseActions = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQueryActions, startTimestamp: startTime, endTimestamp: endTime});\n  // Loop thru each useraction\n  for (var actions = 0; actions < responseActions.values.length; actions++) {\n        responseActions.values[actions][0] = responseActions.values[actions][0].replace(/\"/g, \"\\\"\\\"\");\n        // Get traffic and metric details\n        var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where name=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n        if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where name=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n        if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where name=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n        if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where name=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n        var response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n        // Toss last 30 minutes\n        var sampleCount = response.values.length-6;\n        let percentChangeMetric = 0;\n        let percentChangeTraffic = 0;\n        let trafficAVG = 0;\n        let metricAVG = 0;\n        let metricMIN = response.values[0][2];\n        let metricAAVG = 0;\n        let metricBAVG = 0;\n        let trafficAAVG = 0;\n        let trafficBAVG = 0;\n        let c = 0;\n        while (c < sampleCount) {\n          trafficAVG = trafficAVG + response.values[c][1];\n          metricAVG = metricAVG + response.values[c][2];\n          if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n          c++;\n        }\n        let i2 = 0;\n        let i2A = 0;\n        let i2B = 0;\n          while (i2 < sampleCount) {\n                if (response.values[i2][1]>(trafficAVG/sampleCount))\n                  {\n                    if (response.values[i2][2]!=null)\n                      {\n                    metricAAVG=metricAAVG+response.values[i2][2];\n                    trafficAAVG=trafficAAVG+response.values[i2][1];\n                    i2A++;\n                        }\n                  }\n                if (response.values[i2][1]<(trafficAVG/sampleCount)) \n                  {\n                    if (response.values[i2][2]!=null)\n                      {\n                    metricBAVG=metricBAVG+response.values[i2][2];\n                    trafficBAVG=trafficBAVG+response.values[i2][1];\n                    i2B++;\n                        }\n                  }\n                i2++;\n              }\n        if (metricBAVG==0) metricBAVG=1;\n        percentChangeMetric = (Number(metricAAVG) - Number(metricBAVG))/Number(metricBAVG);\n        percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n        var predictedMetric=(metricAVG) + (metricAVG*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n        if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n        responseActions.values[actions][1]=metricAVG;\n        responseActions.values[actions][2]=predictedMetric;\n  console.log(\"Traffic Below:\",trafficBAVG/i2B)\n  console.log(\"Traffic Average:\",trafficAVG/sampleCount)\n  console.log(\"Traffic Above:\",trafficAAVG/i2A)\n  console.log(\"Traffic Change:\",percentChangeTraffic)\n  console.log(\"Metric Min:\",metricMIN)\n  console.log(\"Metric Below:\",metricBAVG)\n  console.log(\"Metric Average:\",metricAVG)\n  console.log(\"Metric Above:\",metricAAVG)\n  console.log(\"Metric Change:\",percentChangeMetric)\n  console.log(\"Predicted Metric:\",predictedMetric)\n    }\n  \n    return {\n    records: new Array(responseActions.values.length).fill(null).map((_, index, array) => {\n      return {\n        'User Action': responseActions.values[index][0],\n        'Errors': responseActions.values[index][1],\n        'Prediction': responseActions.values[index][2],\n        'Change': responseActions.values[index][2]-responseActions.values[index][1]\n      };\n    }),\n    types: [\n      {\n        indexRange: [0, sampleCount],\n        mappings: {\n          'User Action': { type: 'string' },\n          'Errors': { type: 'double' },\n          'Prediction': { type: 'double' },\n          'Change': { type: 'double' }\n        },\n      },\n    ],\n  };\n}","visualization":"table","visualizationSettings":{"thresholds":[{"id":1,"field":"Errors","title":"","isEnabled":true,"rules":[{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":0.5},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":1},{"id":3,"color":"#00D26A","comparator":"≥","label":"","value":0}]},{"id":2,"field":"Prediction","title":"","isEnabled":true,"rules":[{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":0.5},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":1},{"id":3,"color":"#00D26A","comparator":"≥","label":"","value":0}]},{"id":3,"field":"Change","title":"","isEnabled":true,"rules":[{"id":1,"color":"#FCD53F","comparator":"≥","label":"","value":0.05},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":0.1},{"id":3,"color":"#00D26A","comparator":"≥","label":"","value":-99999999}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"User Action","categoryAxisLabel":"User Action","valueAxis":"Avg Duration","valueAxisLabel":"Avg Duration"}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"start","recordField":"User Action"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"User Action\"]":279,"[\"Errors\"]":87.875,"[\"Prediction\"]":112.734375,"[\"Change\"]":95.796875}},"unitsOverrides":[{"identifier":"Prediction","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1701281148734},{"identifier":"Errors","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1704583008650},{"identifier":"Change","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1704583201091}]}},"46":{"type":"code","title":"Traffic Impact on $LocationFilter Request Errors","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = \"requestErrorCount\";\n  const metricName = \"Error Rate\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  // Get Locations\n  var usqlQueryActions = 'SELECT DISTINCT usersession.'+$LocationFilter+',sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$LocationFilter+' is not null order by D1 DESC limit 100';\n  if ($ActionCategory==\"Key\") usqlQueryActions = 'SELECT DISTINCT usersession.'+$LocationFilter+',sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$LocationFilter+' is not null and keyuseraction is true limit 100';\n  if ($ActionCategory==\"Entry\") usqlQueryActions = 'SELECT DISTINCT usersession.'+$LocationFilter+',sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$LocationFilter+' is not null and isentryaction is true  limit 100';\n  if ($ActionCategory==\"Exit\") usqlQueryActions = 'SELECT DISTINCT usersession.'+$LocationFilter+',sum('+metric+') as D1 from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and usersession.'+$LocationFilter+' is not null and isexitaction is true limit 100';\n  const responseActions = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQueryActions, startTimestamp: startTime, endTimestamp: endTime});\n  // Loop thru each Location\n  for (var actions = 0; actions < responseActions.values.length; actions++) {\n        responseActions.values[actions][0] = responseActions.values[actions][0].replace(/\"/g, \"\\\"\\\"\");\n        // Get traffic and metric details\n        var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where usersession.'+$LocationFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n        if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where usersession.'+$LocationFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n        if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where usersession.'+$LocationFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n        if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", CONDITION (sum('+metric+'), where usersession.'+$LocationFilter+'=\"'+responseActions.values[actions][0]+'\")  AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n        var response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n        // Toss last 30 minutes\n        var sampleCount = response.values.length-6;\n        let percentChangeMetric = 0;\n        let percentChangeTraffic = 0;\n        let trafficAVG = 0;\n        let metricAVG = 0;\n        let metricMIN = response.values[0][2];\n        let metricAAVG = 0;\n        let metricBAVG = 0;\n        let trafficAAVG = 0;\n        let trafficBAVG = 0;\n        let c = 0;\n        while (c < sampleCount) {\n          trafficAVG = trafficAVG + response.values[c][1];\n          metricAVG = metricAVG + response.values[c][2];\n          if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n          c++;\n        }\n        let i2 = 0;\n        let i2A = 0;\n        let i2B = 0;\n          while (i2 < sampleCount) {\n                if (response.values[i2][1]>(trafficAVG/sampleCount))\n                  {\n                    if (response.values[i2][2]!=null)\n                      {\n                    metricAAVG=metricAAVG+response.values[i2][2];\n                    trafficAAVG=trafficAAVG+response.values[i2][1];\n                    i2A++;\n                        }\n                  }\n                if (response.values[i2][1]<(trafficAVG/sampleCount)) \n                  {\n                    if (response.values[i2][2]!=null)\n                      {\n                    metricBAVG=metricBAVG+response.values[i2][2];\n                    trafficBAVG=trafficBAVG+response.values[i2][1];\n                    i2B++;\n                        }\n                  }\n                i2++;\n              }\n        if (metricBAVG==0) metricBAVG=1;\n        percentChangeMetric = (Number(metricAAVG) - Number(metricBAVG))/Number(metricBAVG);\n        percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n        var predictedMetric=(metricAVG) + (metricAVG*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n        if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n        responseActions.values[actions][1]=metricAVG;\n        responseActions.values[actions][2]=predictedMetric;\n  console.log(\"Traffic Below:\",trafficBAVG/i2B)\n  console.log(\"Traffic Average:\",trafficAVG/sampleCount)\n  console.log(\"Traffic Above:\",trafficAAVG/i2A)\n  console.log(\"Traffic Change:\",percentChangeTraffic)\n  console.log(\"Metric Min:\",metricMIN)\n  console.log(\"Metric Below:\",metricBAVG)\n  console.log(\"Metric Average:\",metricAVG)\n  console.log(\"Metric Above:\",metricAAVG)\n  console.log(\"Metric Change:\",percentChangeMetric)\n  console.log(\"Predicted Metric:\",predictedMetric)\n    }\n  \n    return {\n    records: new Array(responseActions.values.length).fill(null).map((_, index, array) => {\n      return {\n        'Location': responseActions.values[index][0],\n        'Errors': responseActions.values[index][1],\n        'Prediction': responseActions.values[index][2],\n        'Change': responseActions.values[index][2]-responseActions.values[index][1]\n      };\n    }),\n    types: [\n      {\n        indexRange: [0, sampleCount],\n        mappings: {\n          'Location': { type: 'string' },\n          'Errors': { type: 'double' },\n          'Prediction': { type: 'double' },\n          'Change': { type: 'double' }\n        },\n      },\n    ],\n  };\n}","visualization":"table","visualizationSettings":{"thresholds":[{"id":1,"field":"Errors","title":"","isEnabled":true,"rules":[{"id":1,"color":"#FCD53F","comparator":">","label":"","value":0},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":5},{"id":3,"color":"#00D26A","comparator":"≤","label":""}]},{"id":2,"field":"Prediction","title":"","isEnabled":true,"rules":[{"id":1,"color":"#FCD53F","comparator":">","label":"","value":0},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":5},{"id":3,"color":"#00D26A","comparator":"≤","label":""}]},{"id":3,"field":"Change","title":"","isEnabled":true,"rules":[{"id":1,"color":"#FCD53F","comparator":">","label":"","value":0},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":5},{"id":3,"color":"#00D26A","comparator":"≤","label":"","value":0}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"User Action","categoryAxisLabel":"User Action","valueAxis":"Avg Duration","valueAxisLabel":"Avg Duration"}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"start","recordField":"Location"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"User Action\"]":169,"[\"Errors\"]":87.875,"[\"Prediction\"]":112.734375,"[\"Change\"]":95.796875},"sortBy":{"columnId":"[\"Change\"]","direction":"descending"}},"unitsOverrides":[{"identifier":"Prediction","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1701281148734},{"identifier":"Errors","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1704583008650},{"identifier":"Change","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1704583201091}]}},"47":{"type":"code","title":"Request Error Change","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = \"requestErrorCount\";\n  const metricName = \"Error Count\";\n  const metricAgg = \"sum\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n  if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n  if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n  if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n  const response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n  if (response.values.length<6) return \"Try increasing the timeframe.\";\n  const sampleCount = response.values.length-6;\n  let percentChangeMetric = 0;\n  let percentChangeTraffic = 0;\n  let trafficAVG = 0;\n  let metricAVG = 0;\n  let metricMIN = response.values[0][2];\n  let metricAAVG = 0;\n  let metricBAVG = 0;\n  let trafficAAVG = 0;\n  let trafficBAVG = 0;\n  let c = 0;\n  while (c < sampleCount) {\n    trafficAVG = trafficAVG + response.values[c][1];\n    metricAVG = metricAVG + response.values[c][2];\n    if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n    c++;\n  }\n  let i2 = 0;\n  let i2A = 0;\n  let i2B = 0;\n    while (i2 < sampleCount) {\n          if (response.values[i2][1]>(trafficAVG/sampleCount))\n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricAAVG=metricAAVG+response.values[i2][2];\n              trafficAAVG=trafficAAVG+response.values[i2][1];\n              i2A++;\n                  }\n            }\n          if (response.values[i2][1]<(trafficAVG/sampleCount)) \n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricBAVG=metricBAVG+response.values[i2][2];\n              trafficBAVG=trafficBAVG+response.values[i2][1];\n              i2B++;\n                  }\n            }\n          i2++;\n        }\n  percentChangeMetric = (Number(metricAAVG/i2A) - Number(metricBAVG/i2B))/Number(metricBAVG/i2B)*100;\n  percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n  var predictedMetric=(metricAVG/sampleCount) + (metricAVG/sampleCount*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n  console.log(\"Traffic Below:\",trafficBAVG/i2B)\n  console.log(\"Traffic Average:\",trafficAVG/sampleCount)\n  console.log(\"Traffic Above:\",trafficAAVG/i2A)\n  console.log(\"Traffic Change:\",percentChangeTraffic)\n  console.log(\"Metric Min:\",metricMIN)\n  console.log(\"Metric Below:\",metricBAVG/i2B)\n  console.log(\"Metric Average:\",metricAVG/sampleCount)\n  console.log(\"Metric Above:\",metricAAVG/i2A)\n  console.log(\"Metric Change:\",percentChangeMetric)\n  console.log(\"Predicted Metric:\",predictedMetric)\n  if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n  return (($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)+0;\n}","visualization":"singleValue","visualizationSettings":{"thresholds":[{"id":1,"field":"element","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≤","label":"","value":-3},{"id":1,"color":"#FCD53F","comparator":">","label":"","value":-3},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":3}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","trend":{"isVisible":false},"sparklineSettings":{"isVisible":false},"colorThresholdTarget":"value","recordField":"element"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"element","unitCategory":"percentage","baseUnit":"percent","displayUnit":"percent","decimals":2,"suffix":"%","delimiter":false,"added":1701281148734}]}},"48":{"type":"code","title":"JavaScript Error Change","input":"import { rumUserSessionsClient } from \"@dynatrace-sdk/client-classic-environment-v1\";\nexport default async function () {\n  const metric = \"javascriptErrorCount\";\n  const metricName = \"Error Count\";\n  const metricAgg = \"sum\";\n  const startTime = Date.parse($dt_timeframe_from).toString();  // Get Dashboard Start Time\n  const endTime = Date.parse($dt_timeframe_to).toString();      // Get Dashboard End Time\n  // Calculate Chart Interval\n  const timeDiff = (endTime-startTime)/3600/1000/24;\n  var chartInterval = \"5m\"\n  var appsList = \"\\\"\"+$AppName[0]+\"\\\"\";\n  let i = 1;\n  // Build Apps List\n  while (i < 10) {\n    if ($AppName[i]==null) break;\n    appsList = appsList+\",\\\"\"+$AppName[i]+\"\\\"\";\n    i++;\n  }\n  var typeList = \"\\\"\"+$ActionType[0]+\"\\\"\";\n  let t = 1;\n  // Build Type List\n  while (t < 3) {\n    if ($ActionType[t]==null) break;\n    typeList = typeList+\",\\\"\"+$ActionType[t]+\"\\\"\";\n    t++;\n  }\n  var usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' limit 5000';\n  if ($ActionCategory==\"Key\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and keyuseraction is true limit 5000';\n  if ($ActionCategory==\"Entry\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isentryaction is true  limit 5000';\n  if ($ActionCategory==\"Exit\") usqlQuery = 'SELECT DISTINCT DATETIME(endTime,  \"MM-dd HH:mm:ss\",\"'+chartInterval+'\") AS \"Date\", count(*) AS \"Count\", '+metricAgg+'('+metric+') AS \"Metric\" from useraction WHERE useraction.type in ('+typeList+') and useraction.application in ('+appsList+') and usersession.starttime>='+startTime+' and usersession.endtime<='+endTime+' and isexitaction is true limit 5000';\n  const response = await rumUserSessionsClient.getUsqlResultAsTable({query: usqlQuery, startTimestamp: startTime, endTimestamp: endTime});\n  if (response.values.length<6) return \"Try increasing the timeframe.\";\n  const sampleCount = response.values.length-6;\n  let percentChangeMetric = 0;\n  let percentChangeTraffic = 0;\n  let trafficAVG = 0;\n  let metricAVG = 0;\n  let metricMIN = response.values[0][2];\n  let metricAAVG = 0;\n  let metricBAVG = 0;\n  let trafficAAVG = 0;\n  let trafficBAVG = 0;\n  let c = 0;\n  while (c < sampleCount) {\n    trafficAVG = trafficAVG + response.values[c][1];\n    metricAVG = metricAVG + response.values[c][2];\n    if (response.values[c][2]<metricMIN) metricMIN=response.values[c][2];\n    c++;\n  }\n  let i2 = 0;\n  let i2A = 0;\n  let i2B = 0;\n    while (i2 < sampleCount) {\n          if (response.values[i2][1]>(trafficAVG/sampleCount))\n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricAAVG=metricAAVG+response.values[i2][2];\n              trafficAAVG=trafficAAVG+response.values[i2][1];\n              i2A++;\n                  }\n            }\n          if (response.values[i2][1]<(trafficAVG/sampleCount)) \n            {\n              if (response.values[i2][2]!=null)\n                {\n              metricBAVG=metricBAVG+response.values[i2][2];\n              trafficBAVG=trafficBAVG+response.values[i2][1];\n              i2B++;\n                  }\n            }\n          i2++;\n        }\n  percentChangeMetric = (Number(metricAAVG/i2A) - Number(metricBAVG/i2B))/Number(metricBAVG/i2B)*100;\n  percentChangeTraffic = (Number(trafficAAVG/i2A) - Number(trafficBAVG/i2B))/Number(trafficBAVG/i2B)*100;\n  var predictedMetric=(metricAVG/sampleCount) + (metricAVG/sampleCount*(($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)/100);\n  console.log(\"Traffic Below:\",trafficBAVG/i2B)\n  console.log(\"Traffic Average:\",trafficAVG/sampleCount)\n  console.log(\"Traffic Above:\",trafficAAVG/i2A)\n  console.log(\"Traffic Change:\",percentChangeTraffic)\n  console.log(\"Metric Min:\",metricMIN)\n  console.log(\"Metric Below:\",metricBAVG/i2B)\n  console.log(\"Metric Average:\",metricAVG/sampleCount)\n  console.log(\"Metric Above:\",metricAAVG/i2A)\n  console.log(\"Metric Change:\",percentChangeMetric)\n  console.log(\"Predicted Metric:\",predictedMetric)\n  if (predictedMetric<metricMIN) predictedMetric=metricMIN;\n  return (($TrafficChangePercent/percentChangeTraffic)*percentChangeMetric)+0;\n}","visualization":"singleValue","visualizationSettings":{"thresholds":[{"id":1,"field":"element","title":"","isEnabled":true,"rules":[{"id":0,"color":"#00D26A","comparator":"≤","label":"","value":-3},{"id":1,"color":"#FCD53F","comparator":">","label":"","value":-3},{"id":2,"color":"#F8312F","comparator":"≥","label":"","value":3}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","autoscale":true,"alignment":"center","trend":{"isVisible":false},"sparklineSettings":{"isVisible":false},"colorThresholdTarget":"value","recordField":"element"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"element","unitCategory":"percentage","baseUnit":"percent","displayUnit":"percent","decimals":2,"suffix":"%","delimiter":false,"added":1701281148734}]}},"49":{"type":"markdown","title":"","content":"[**Help**](https://github.com/TechShady/Dynatrace-Dashboards-Gen3/blob/main/ReadMeTrafficSimulator.md#user-guide)"}},"layouts":{"2":{"x":4,"y":4,"w":20,"h":2},"5":{"x":0,"y":4,"w":4,"h":2},"7":{"x":0,"y":11,"w":8,"h":9},"10":{"x":12,"y":1,"w":4,"h":2},"11":{"x":0,"y":0,"w":24,"h":1},"12":{"x":0,"y":3,"w":24,"h":1},"13":{"x":0,"y":1,"w":8,"h":2},"14":{"x":0,"y":33,"w":22,"h":1},"15":{"x":0,"y":10,"w":24,"h":1},"17":{"x":16,"y":1,"w":4,"h":2},"18":{"x":4,"y":6,"w":20,"h":2},"20":{"x":4,"y":8,"w":20,"h":2},"21":{"x":20,"y":1,"w":4,"h":2},"22":{"x":8,"y":1,"w":4,"h":2},"24":{"x":8,"y":11,"w":8,"h":9},"25":{"x":16,"y":11,"w":8,"h":9},"32":{"x":0,"y":20,"w":24,"h":1},"35":{"x":0,"y":21,"w":8,"h":4},"36":{"x":0,"y":25,"w":8,"h":4},"37":{"x":0,"y":29,"w":8,"h":4},"39":{"x":8,"y":29,"w":8,"h":4},"40":{"x":16,"y":25,"w":8,"h":4},"42":{"x":16,"y":29,"w":8,"h":4},"43":{"x":8,"y":21,"w":8,"h":4},"44":{"x":16,"y":21,"w":8,"h":4},"46":{"x":8,"y":25,"w":8,"h":4},"47":{"x":0,"y":6,"w":4,"h":2},"48":{"x":0,"y":8,"w":4,"h":2},"49":{"x":22,"y":33,"w":2,"h":1}}}