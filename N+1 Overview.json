{"version":20,"variables":[],"tiles":{"0":{"title":"Top N+1 Spans","description":"Top N+1 Spans (Spans with >25 N+1 Database queries).","type":"data","query":"fetch spans\n| filter db.system != \"null\" and aggregation.count>25\n| fields `N+1 Count` = aggregation.count,`Query`=db.query.text,trace.id,span.id,span.name, `Service Name` = entityName(dt.entity.service), `DB` = db.namespace\n| sort `N+1 Count` desc","visualization":"table","visualizationSettings":{"table":{"hiddenColumns":[["supportability.alr_sampling_ratio"],["sampling.threshold"],["start_time"],["end_time"],["dt.ingest.size"],["supportability.atm_sampling_ratio"],["server.port"],["weblogic.domain.name"],["server.address"],["thread.id"],["dt.retain.size"],["span.timing.cpu"],["span.is_subroutine"],["java.main.class"],["dt.agent.module.id"],["subtrace.id"],["server.resolved_ips"],["weblogic.server.name"],["process.executable.path"],["dt.openpipeline.pipelines"],["db.operation.name"],["db.system"],["process.pid"],["code.namespace"],["dt.agent.module.type"],["dt.process_group.detected_name"],["process.executable.name"],["dt.agent.module.version"],["span.parent_id"],["dt.entity.host"],["aggregation.exception_count"],["dt.openpipeline.source"],["span.kind"],["aggregation.duration_sum"],["thread.name"],["duration"],["span.timing.cpu_self"],["http.server_name"],["dt.entity.process_group_instance"],["dt.agent.module.version_short"],["servlet.context.path"],["dt.system.monitoring_source"],["aggregation.parallel_execution"],["aggregation.duration_samples"],["db.affected_item_count"],["aggregation.duration_max"],["aggregation.duration_min"],["code.call_stack"],["db.result.exception_count"],["spring.application.name"],["trace.id"],["span.id"],["span.name"],["dt.entity.service"]],"hideColumnsForLargeResults":false,"sortBy":[{"columnId":"[\"N+1 Count\"]","direction":"descending"}],"columnWidths":{"[\"dt.ingest.size\"]":197.01,"[\"db.query.text\"]":207,"[\"aggregation.count\"]":167,"[\"Query\"]":504.2,"[\"service_name\"]":282.14,"[\"N+1 Count\"]":97,"[\"DB\"]":57},"columnOrder":["[\"N+1 Count\"]","[\"Query\"]","[\"trace.id\"]","[\"span.id\"]","[\"span.name\"]","[\"DB\"]","[\"Service Name\"]"]},"autoSelectVisualization":false},"querySettings":{"maxResultRecords":100000,"defaultScanLimitGbytes":1000,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"timeframe":{"tileTimeframe":{"from":"now()-10d","to":"now()"},"tileTimeframeEnabled":false}},"1":{"title":"","description":"Scatter plot of N+1 Spans. Plots that are clustered together indicates heavy database, network and host utilization caused by N+1 queries. Plots at the top of the graph indicates Spans that have a high number of N+1 queries which will also cause heavy database, network and host utilization.","type":"data","query":"fetch spans\n| filter db.system != \"null\" and aggregation.count>25\n| fields end_time,aggregation.count,db.query.text,trace.id,span.id,span.name,dt.entity.service, service_name = entityName(dt.entity.service), db.namespace\n| sort aggregation.count desc","visualization":"lineChart","visualizationSettings":{"chartSettings":{"legend":{"hidden":true},"fieldMapping":{"leftAxisValues":["aggregation.count"]},"leftYAxisSettings":{"label":"N+1 Queries","isLabelVisible":true}},"legend":{"ratio":28},"autoSelectVisualization":false,"dataMapping":{"displayedFields":["service_name"]}},"querySettings":{"maxResultRecords":100000,"defaultScanLimitGbytes":100000,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"timeframe":{"tileTimeframe":{"from":"now()-10d","to":"now()"},"tileTimeframeEnabled":false}},"2":{"title":"","type":"data","query":"data record(a=\" N+1 KPIs\")","visualization":"singleValue","visualizationSettings":{"singleValue":{"labelMode":"none","label":" ","recordField":"a","prefixIcon":"SingleValueChartIcon","colorThresholdTarget":"background","trend":{"isVisible":true},"isIconVisible":true},"thresholds":[{"id":1,"field":"a","title":"","isEnabled":true,"rules":[{"id":0,"color":{"Default":"var(--dt-colors-charts-categorical-color-01-default, #134fc9)"},"comparator":"!=","label":"","value":"0"}]}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"3":{"title":"","type":"data","query":"data record(a=\"Top N+1 Spans Over Time\")","visualization":"singleValue","visualizationSettings":{"singleValue":{"labelMode":"none","label":" ","recordField":"a","prefixIcon":"ScatterplotIcon","colorThresholdTarget":"background","trend":{"isVisible":true},"isIconVisible":true},"thresholds":[{"id":1,"field":"a","title":"","isEnabled":true,"rules":[{"id":0,"color":{"Default":"var(--dt-colors-charts-categorical-color-01-default, #134fc9)"},"comparator":"!=","label":"","value":"0"}]}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"4":{"title":"","type":"data","query":"data record(a=\".\")","visualization":"singleValue","visualizationSettings":{"singleValue":{"labelMode":"none","label":" ","recordField":"a","prefixIcon":"ScatterplotIcon","colorThresholdTarget":"background","trend":{"isVisible":true}},"thresholds":[{"id":1,"field":"a","title":"","isEnabled":true,"rules":[{"id":0,"color":{"Default":"var(--dt-colors-charts-categorical-color-01-default, #134fc9)"},"comparator":"!=","label":"","value":"0"}]}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"5":{"title":"Number of N Queries","description":"Total number of N Database queries. This number excludes the +1 query and indicates the true number of queries that can be reduced.","type":"data","query":"fetch spans\n| filter db.system != \"null\"\n| filter aggregation.count>1\n| summarize total_aggregation_count = sum(aggregation.count) - count()\n","visualization":"singleValue","visualizationSettings":{"singleValue":{"labelMode":"none","label":"total ","recordField":"total_aggregation_count"},"autoSelectVisualization":false,"thresholds":[{"id":1,"field":"total_aggregation_count","title":"","isEnabled":true,"rules":[{"id":2,"color":{"Default":"var(--dt-colors-charts-status-critical-default, #c62239)"},"comparator":"≥","label":"","value":0}]}],"unitsOverrides":[{"identifier":"total_aggregation_count","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":true,"added":1763569476314}]},"querySettings":{"maxResultRecords":10000,"defaultScanLimitGbytes":1000,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"timeframe":{"tileTimeframe":{"from":"now()-10d","to":"now()"},"tileTimeframeEnabled":false}},"6":{"title":"N+1 Spans","description":"The number of Spans that have N+1 Database queries.","type":"data","query":"fetch spans\n| filter db.system != \"null\"\n| filter aggregation.count>1\n| summarize total_spans = count()\n","visualization":"singleValue","visualizationSettings":{"singleValue":{"labelMode":"none","label":"total ","recordField":"total_spans"},"autoSelectVisualization":false,"thresholds":[{"id":1,"field":"total_spans","title":"","isEnabled":true,"rules":[{"id":2,"color":{"Default":"var(--dt-colors-charts-status-critical-default, #c62239)"},"comparator":"≥","label":"","value":0}]}],"unitsOverrides":[{"identifier":"total_spans","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":null,"suffix":"","delimiter":true,"added":1763569891698}]},"querySettings":{"maxResultRecords":10000,"defaultScanLimitGbytes":1000,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"timeframe":{"tileTimeframe":{"from":"now()-10d","to":"now()"},"tileTimeframeEnabled":false}},"9":{"title":"Avg Queries per N+1 Span","description":"Average number of Database queries from N+1 Spans.","type":"data","query":"fetch spans\n| filter db.system != \"null\"\n| filter aggregation.count > 1\n| summarize total_aggregation_count = sum(aggregation.count), total_spans = count()\n| fieldsAdd average_count = total_aggregation_count / total_spans\n\n\n","visualization":"singleValue","visualizationSettings":{"singleValue":{"labelMode":"none","recordField":"average_count"},"autoSelectVisualization":false,"thresholds":[{"id":1,"field":"average_count","title":"","isEnabled":true,"rules":[{"id":2,"color":{"Default":"var(--dt-colors-charts-status-critical-default, #c62239)"},"comparator":"≥","label":"","value":0}]}],"unitsOverrides":[{"identifier":"total_aggregation_count","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":null,"suffix":"","delimiter":false,"added":1763925305782}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}},"10":{"title":"Max Queries per N+1 Spans","description":"Number of Database queries from top N+1 Span.","type":"data","query":"fetch spans\n| filter db.system != \"null\"\n| filter aggregation.count>1\n| summarize total_aggregation_count = max(aggregation.count)\n","visualization":"singleValue","visualizationSettings":{"singleValue":{"labelMode":"none","label":"total ","recordField":"total_aggregation_count"},"autoSelectVisualization":false,"thresholds":[{"id":1,"field":"total_aggregation_count","title":"","isEnabled":true,"rules":[{"id":2,"color":{"Default":"var(--dt-colors-charts-status-critical-default, #c62239)"},"comparator":"≥","label":"","value":0}]}],"unitsOverrides":[{"identifier":"total_aggregation_count","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1763569476314}]},"querySettings":{"maxResultRecords":10000,"defaultScanLimitGbytes":1000,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"timeframe":{"tileTimeframe":{"from":"now()-10d","to":"now()"},"tileTimeframeEnabled":false}},"11":{"title":"Query Reduction Potential","description":"Percentage of N queries compared to all Database queries. This number indicates the percentage of queries that can be reduced.","type":"data","query":"fetch spans\n| filter db.system != \"null\"\n| summarize c=count(), s= sum(aggregation.count), \n            c1=countif(aggregation.count > 1), s1=sum(if(aggregation.count > 1, aggregation.count))\n| fieldsAdd queryReduction = ((toDouble(s1)-toDouble(c1)) / toDouble(s)) * 100\n","visualization":"singleValue","visualizationSettings":{"singleValue":{"labelMode":"none","recordField":"queryReduction"},"autoSelectVisualization":false,"thresholds":[{"id":1,"field":"queryReduction","title":"","isEnabled":true,"rules":[{"id":2,"color":{"Default":"var(--dt-colors-charts-status-critical-default, #c62239)"},"comparator":"≥","label":"","value":0}]}],"unitsOverrides":[{"identifier":"queryReduction","unitCategory":"percentage","baseUnit":"percent","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1763569891698}]},"querySettings":{"maxResultRecords":10000,"defaultScanLimitGbytes":1000,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"timeframe":{"tileTimeframe":{"from":"now()-10d","to":"now()"},"tileTimeframeEnabled":false}},"13":{"title":"N+1 Services","description":"Distribution of Services that have N+1 Database queries.","type":"data","query":"fetch spans\n| filter db.system != \"null\" and aggregation.count>1\n| fields aggregation.count, service_name = entityName(dt.entity.service)\n| summarize count=sum(aggregation.count),by:{service_name}\n| sort count desc","visualization":"pieChart","visualizationSettings":{"autoSelectVisualization":false,"chartSettings":{"legend":{"position":"bottom"},"categoricalBarChartSettings":{"categoryAxis":["service_name","trace"],"categoryAxisLabel":"service_name,trace"}},"legend":{"ratio":27}},"querySettings":{"maxResultRecords":10000,"defaultScanLimitGbytes":1000,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"timeframe":{"tileTimeframe":{"from":"now()-10d","to":"now()"},"tileTimeframeEnabled":false}},"16":{"title":"Number of Database Queries","description":"Total number of Database queries.","type":"data","query":"fetch spans\n| filter db.system != \"null\"\n| summarize total_aggregation_count = sum(aggregation.count)\n","visualization":"singleValue","visualizationSettings":{"singleValue":{"labelMode":"none","label":"total ","recordField":"total_aggregation_count"},"autoSelectVisualization":false,"thresholds":[{"id":1,"field":"total_aggregation_count","title":"","isEnabled":true,"rules":[{"id":2,"color":{"Default":"var(--dt-colors-charts-status-critical-default, #c62239)"},"comparator":"≥","label":"","value":0}]}],"unitsOverrides":[{"identifier":"total_aggregation_count","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":true,"added":1763569476314}]},"querySettings":{"maxResultRecords":10000,"defaultScanLimitGbytes":1000,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"timeframe":{"tileTimeframe":{"from":"now()-10d","to":"now()"},"tileTimeframeEnabled":false}},"17":{"title":"N+1 Databases","description":"Distribution of Databases that have N+1 Database queries.","type":"data","query":"fetch spans\n| filter db.system != \"null\" and aggregation.count>1\n| fields db.namespace,aggregation.count, service_name = entityName(dt.entity.service)\n| summarize count=sum(aggregation.count),by:{db.namespace}\n| sort count desc","visualization":"pieChart","visualizationSettings":{"autoSelectVisualization":false,"chartSettings":{"legend":{"position":"bottom"},"categoricalBarChartSettings":{"categoryAxis":["service_name","trace","db.system","db.namespace"],"categoryAxisLabel":"service_name,trace,db.system,db.namespace"}},"legend":{"ratio":27}},"querySettings":{"maxResultRecords":10000,"defaultScanLimitGbytes":1000,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"timeframe":{"tileTimeframe":{"from":"now()-10d","to":"now()"},"tileTimeframeEnabled":false}},"18":{"title":"","type":"data","query":"data record(a=\" N+1 Services, Spans and Databases\")","visualization":"singleValue","visualizationSettings":{"singleValue":{"labelMode":"none","label":" ","recordField":"a","prefixIcon":"TracesIcon","colorThresholdTarget":"background","trend":{"isVisible":true},"isIconVisible":true},"thresholds":[{"id":1,"field":"a","title":"","isEnabled":true,"rules":[{"id":0,"color":{"Default":"var(--dt-colors-charts-categorical-color-01-default, #134fc9)"},"comparator":"!=","label":"","value":"0"}]}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false},"davis":{"enabled":false,"davisVisualization":{"isAvailable":true}}}},"layouts":{"0":{"x":5,"y":4,"w":14,"h":6},"1":{"x":0,"y":11,"w":24,"h":15},"2":{"x":0,"y":0,"w":24,"h":1},"3":{"x":0,"y":10,"w":24,"h":1},"4":{"x":0,"y":26,"w":24,"h":1},"5":{"x":15,"y":1,"w":4,"h":2},"6":{"x":0,"y":1,"w":3,"h":2},"9":{"x":3,"y":1,"w":4,"h":2},"10":{"x":7,"y":1,"w":4,"h":2},"11":{"x":19,"y":1,"w":5,"h":2},"13":{"x":0,"y":4,"w":5,"h":6},"16":{"x":11,"y":1,"w":4,"h":2},"17":{"x":19,"y":4,"w":5,"h":6},"18":{"x":0,"y":3,"w":24,"h":1}},"importedWithCode":false,"settings":{}}